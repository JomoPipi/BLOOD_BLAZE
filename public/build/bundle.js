var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function s(t){t.forEach(e)}function a(t){return"function"==typeof t}function o(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function i(t,e){t.appendChild(e)}function l(t,e,n){t.insertBefore(e,n||null)}function r(t){t.parentNode.removeChild(t)}function c(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function u(t){return document.createElement(t)}function h(t){return document.createTextNode(t)}function d(){return h(" ")}function p(t,e,n,s){return t.addEventListener(e,n,s),()=>t.removeEventListener(e,n,s)}function m(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function f(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function y(t,e,n){t.classList[n?"add":"remove"](e)}let g;function P(t){g=t}function T(t){(function(){if(!g)throw new Error("Function called outside component initialization");return g})().$$.on_mount.push(t)}const b=[],S=[],x=[],E=[],v=Promise.resolve();let N=!1;function w(t){x.push(t)}let $=!1;const A=new Set;function C(){if(!$){$=!0;do{for(let t=0;t<b.length;t+=1){const e=b[t];P(e),O(e.$$)}for(b.length=0;S.length;)S.pop()();for(let t=0;t<x.length;t+=1){const e=x[t];A.has(e)||(A.add(e),e())}x.length=0}while(b.length);for(;E.length;)E.pop()();N=!1,$=!1,A.clear()}}function O(t){if(null!==t.fragment){t.update(),s(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(w)}}const _=new Set;let I;function k(){I={r:0,c:[],p:I}}function R(){I.r||s(I.c),I=I.p}function M(t,e){t&&t.i&&(_.delete(t),t.i(e))}function L(t,e,n,s){if(t&&t.o){if(_.has(t))return;_.add(t),I.c.push((()=>{_.delete(t),s&&(n&&t.d(1),s())})),t.o(e)}}function D(t){t&&t.c()}function Y(t,n,o){const{fragment:i,on_mount:l,on_destroy:r,after_update:c}=t.$$;i&&i.m(n,o),w((()=>{const n=l.map(e).filter(a);r?r.push(...n):s(n),t.$$.on_mount=[]})),c.forEach(w)}function B(t,e){const n=t.$$;null!==n.fragment&&(s(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function W(t,e){-1===t.$$.dirty[0]&&(b.push(t),N||(N=!0,v.then(C)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function z(e,a,o,i,l,c,u=[-1]){const h=g;P(e);const d=a.props||{},p=e.$$={fragment:null,ctx:null,props:c,update:t,not_equal:l,bound:n(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(h?h.$$.context:[]),callbacks:n(),dirty:u};let m=!1;if(p.ctx=o?o(e,d,((t,n,...s)=>{const a=s.length?s[0]:n;return p.ctx&&l(p.ctx[t],p.ctx[t]=a)&&(p.bound[t]&&p.bound[t](a),m&&W(e,t)),n})):[],p.update(),m=!0,s(p.before_update),p.fragment=!!i&&i(p.ctx),a.target){if(a.hydrate){const t=function(t){return Array.from(t.childNodes)}(a.target);p.fragment&&p.fragment.l(t),t.forEach(r)}else p.fragment&&p.fragment.c();a.intro&&M(e.$$.fragment),Y(e,a.target,a.anchor),C()}P(h)}class G{$destroy(){B(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(){}}function U(e){let n,a,o,c,y,g,P,T,b,S,x,E,v,N,w,$,A,C,O,_,I;return{c(){n=u("main"),a=u("span"),o=u("h1"),c=u("span"),c.textContent="BLOOD",y=d(),g=u("span"),P=h(e[0]),T=d(),b=u("h2"),b.textContent="A Devastating Bloodbath of Boundless Mortality",S=d(),x=u("span"),E=u("form"),v=u("input"),N=d(),w=u("button"),w.textContent="GO",$=d(),A=u("span"),C=d(),O=u("bloodblaze"),m(c,"class","_1 svelte-151gubb"),m(g,"class","_2 svelte-151gubb"),m(o,"class","svelte-151gubb"),m(b,"class","svelte-151gubb"),m(a,"class","title svelte-151gubb"),m(v,"autocomplete","off"),m(v,"placeholder","Enter your name"),m(v,"pattern","[A-Za-z0-9 _]*"),m(v,"maxlength",e[2]),m(v,"class","svelte-151gubb"),m(w,"class","svelte-151gubb"),m(E,"type","text"),m(E,"action",""),m(O,"class","svelte-151gubb"),m(x,"class","inner svelte-151gubb"),m(n,"class","svelte-151gubb")},m(t,s){l(t,n,s),i(n,a),i(a,o),i(o,c),i(o,y),i(o,g),i(g,P),i(a,T),i(a,b),i(n,S),i(n,x),i(x,E),i(E,v),i(E,N),i(E,w),i(x,$),i(x,A),i(x,C),i(x,O),_||(I=[p(v,"keyup",X),p(E,"submit",e[1])],_=!0)},p(t,[e]){1&e&&f(P,t[0])},i:t,o:t,d(t){t&&r(n),_=!1,s(I)}}}function X(t){t.target.value=t.target.value.replace(/[^A-Za-z0-9 _]/g,"").slice(0,CONSTANTS.USERNAME_CHARACTER_LIMIT)}function q(t,e,n){let{proceed:s}=e,{blaze:a}=e,{socket:o}=e;T((()=>{o.on("nomination",(([t,e])=>{t&&(o.removeAllListeners("nomination"),s(e)),alert(t?`Welcome, ${e}!`:`Sorry, "${e}" is not available.`)})),CONSTANTS.DEV_MODE&&o.emit("nomination",Math.random().toString())}));const i=CONSTANTS.USERNAME_CHARACTER_LIMIT;return t.$set=t=>{"proceed"in t&&n(3,s=t.proceed),"blaze"in t&&n(0,a=t.blaze),"socket"in t&&n(4,o=t.socket)},[a,function(t){t.preventDefault();const e=t.target.children[0];e.value&&(o.emit("nomination",e.value),e.value="")},i,s,o]}class j extends G{constructor(t){super(),z(this,t,q,U,o,{proceed:3,blaze:0,socket:4})}}function F(e){let n;return{c(){n=u("canvas"),m(n,"class","svelte-eupre8")},m(t,s){l(t,n,s),e[2](n)},p:t,i:t,o:t,d(t){t&&r(n),e[2](null)}}}function V(t,e,n){let s,a,o,i;const l=window.innerWidth/2.5/PHI;let{callback:r=(()=>0)}=e,c=0;function u(){i.clearRect(0,0,a,o),i.strokeStyle="#fba";const[t,e]=[40*Math.cos(c)+a/2,40*Math.sin(c)+o/2];i.beginPath(),i.arc(a/2,o/2,40,0,7),i.closePath(),i.stroke(),i.beginPath(),i.arc(t,e,6,0,7),i.fill()}return T((()=>{a=n(0,s.width=o=n(0,s.height=l,s),s),i=s.getContext("2d"),n(0,s.style.margin="5px",s),n(0,s.style.backgroundColor="transparent",s),u(),n(0,s.ontouchstart=()=>r(c,!0),s),n(0,s.ontouchmove=function(t){const e=+s.offsetLeft,n=+s.offsetTop,i=t.targetTouches[0].clientX-e-a/2,l=t.targetTouches[0].clientY-n-o/2,h=Math.atan2(l,i);c=h,u(),r(h,!0)},s),n(0,s.ontouchend=()=>r(c,!1),s)})),t.$set=t=>{"callback"in t&&n(1,r=t.callback)},[s,r,function(t){S[t?"unshift":"push"]((()=>{s=t,n(0,s)}))}]}class H extends G{constructor(t){super(),z(this,t,V,F,o,{callback:1})}}function K(e){let n,s;return{c(){n=u("div"),s=u("canvas"),m(s,"class","svelte-18l9nl"),m(n,"class","svelte-18l9nl")},m(t,a){l(t,n,a),i(n,s),e[3](s),e[4](n)},p:t,i:t,o:t,d(t){t&&r(n),e[3](null),e[4](null)}}}function Z(t,e,n){let s,a,o,i,l,r;const c=window.innerWidth/2.5/PHI;let{callback:u=(()=>0)}=e;function h(){l.clearRect(0,0,o,i),l.strokeStyle="black",l.lineWidth=8,l.fillStyle="rgb(71, 61, 61)",l.beginPath();const[t,e]=r;l.arc(t,e,40,0,7),l.closePath(),l.stroke(),l.fill();const s=t-o/2,c=e-i/2,u=1.2*Math.PI/4;n(1,a.style.transform=`\n        perspective(200px) \n        rotateY(${u*s|0}deg)\n        rotateX(${-u*c|0}deg)`,a)}return T((()=>{n(0,s.style.width=n(0,s.style.height=Math.round(c)+"px",s),s),o=n(1,a.width=i=n(1,a.height=Math.round(1.5*c),a),a);const t=.5*Math.floor(c-1.5*c);n(1,a.style.left=n(1,a.style.top=t+"px",a),a),l=a.getContext("2d"),r=[o/2,i/2],h(),n(0,s.ontouchstart=function(t){e=t.targetTouches[0].clientX,d=t.targetTouches[0].clientY},s),n(0,s.ontouchmove=function(t){const n=.75*(t.targetTouches[0].clientX-e),s=.75*(t.targetTouches[0].clientY-d),a=o/2-40-8,i=Math.pow(a,2),l=Math.pow(n,2)+Math.pow(s,2),c=Math.sqrt(i/l),[p,m]=l>i?[n*c,s*c]:[n,s];r[0]=p+o/2,r[1]=m+o/2,h();u(p/a,m/a)},s),n(0,s.ontouchend=function(){r[0]=o/2,r[1]=i/2,h(),u(0,0)},s);let e=0,d=0})),t.$set=t=>{"callback"in t&&n(2,u=t.callback)},[s,a,u,function(t){S[t?"unshift":"push"]((()=>{a=t,n(1,a)}))},function(t){S[t?"unshift":"push"]((()=>{s=t,n(0,s)}))}]}class J extends G{constructor(t){super(),z(this,t,Z,K,o,{callback:2})}}const Q={enableClientSidePrediction:!0,showPredictedPlayer:!0,showServerPlayer:!1,showServerBullet:!1,showClientBullet:!1,showIdealClientBullet:!0,showClientPredictedBullet:!0,showExtrapolatedEnemyPositions:!0,showInterpolatedEnemyPositions:!1,showUninterpolatedEnemyPositions:!1,showWhatOtherClientsPredict:!1,showGameMetadeta:!0};function tt(t,e,n){const s=t.slice();return s[4]=e[n],s}function et(t){let e,n,s,a,o,c,f,y,g=t[4].split(st).map(at).join(" ")+"";function P(){t[3].call(n,t[4])}return{c(){e=u("label"),n=u("input"),s=d(),a=u("h4"),o=h(g),c=d(),m(n,"type","checkbox"),m(a,"class","svelte-1p5603t"),m(e,"class","svelte-1p5603t")},m(r,u){l(r,e,u),i(e,n),n.checked=t[0][t[4]],i(e,s),i(e,a),i(a,o),i(e,c),f||(y=p(n,"change",P),f=!0)},p(e,s){t=e,5&s&&(n.checked=t[0][t[4]])},d(t){t&&r(e),f=!1,y()}}}function nt(e){let n,o,h,f,g,P,T,b=e[2],S=[];for(let t=0;t<b.length;t+=1)S[t]=et(tt(e,b,t));return{c(){n=u("button"),n.textContent="⚙️",o=d(),h=u("div"),f=u("button"),f.textContent="back",g=d();for(let t=0;t<S.length;t+=1)S[t].c();m(n,"class","settings-button svelte-1p5603t"),m(h,"class","settings-page svelte-1p5603t"),y(h,"show",e[1].isOpen)},m(t,s){l(t,n,s),l(t,o,s),l(t,h,s),i(h,f),i(h,g);for(let t=0;t<S.length;t+=1)S[t].m(h,null);P||(T=[p(n,"click",(function(){a(e[1].toggle)&&e[1].toggle.apply(this,arguments)})),p(f,"click",(function(){a(e[1].toggle)&&e[1].toggle.apply(this,arguments)}))],P=!0)},p(t,[n]){if(e=t,5&n){let t;for(b=e[2],t=0;t<b.length;t+=1){const s=tt(e,b,t);S[t]?S[t].p(s,n):(S[t]=et(s),S[t].c(),S[t].m(h,null))}for(;t<S.length;t+=1)S[t].d(1);S.length=b.length}2&n&&y(h,"show",e[1].isOpen)},i:t,o:t,d(t){t&&r(n),t&&r(o),t&&r(h),c(S,t),P=!1,s(T)}}}const st=/([A-Z]+|[A-Z]?[a-z]+)(?=[A-Z]|\b)/,at=t=>t[0]?t[0].toUpperCase()+t.slice(1):t;function ot(t,e,n){const s=Object.keys(Q).filter((t=>"boolean"==typeof Q[t])),a={toggle(){n(1,a.isOpen^=1,a)},isOpen:0};return[Q,a,s,function(t){Q[t]=this.checked,n(0,Q),n(2,s)}]}class it extends G{constructor(t){super(),z(this,t,ot,nt,o,{})}}function lt(e){let n,s,a,o;return{c(){n=u("h4"),s=h(e[0]),a=h(" - "),o=h(e[1]),m(n,"class","svelte-13vahyg")},m(t,r){l(t,n,r),i(n,s),i(n,a),i(n,o),e[4](n)},p(t,[e]){1&e&&f(s,t[0]),2&e&&f(o,t[1])},i:t,o:t,d(t){t&&r(n),e[4](null)}}}function rt(t,e,n){let s,{name:a}=e,{value:o}=e,{maximum:i}=e,l=!1;return T((()=>{n(2,s.style.background=`linear-gradient(to right, #39f ${Math.round(100*o/i)}%, #111 0%)`,s),n(5,l=!0)})),t.$set=t=>{"name"in t&&n(0,a=t.name),"value"in t&&n(1,o=t.value),"maximum"in t&&n(3,i=t.maximum)},t.$$.update=()=>{42&t.$$.dirty&&l&&n(2,s.style.background=`linear-gradient(to right, #39f ${Math.round(100*o/i)}%, #111 0%)`,s)},[a,o,s,i,function(t){S[t?"unshift":"push"]((()=>{s=t,n(2,s),n(5,l),n(1,o),n(3,i)}))}]}class ct extends G{constructor(t){super(),z(this,t,rt,lt,o,{name:0,value:1,maximum:3})}}function ut(t,e,n){const s=t.slice();return s[2]=e[n],s}function ht(t){let e,n;return e=new ct({props:{name:t[2].name,value:t[2].value,maximum:t[0][0]?.value||0}}),{c(){D(e.$$.fragment)},m(t,s){Y(e,t,s),n=!0},p(t,n){const s={};1&n&&(s.name=t[2].name),1&n&&(s.value=t[2].value),1&n&&(s.maximum=t[0][0]?.value||0),e.$set(s)},i(t){n||(M(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){B(e,t)}}}function dt(t){let e,n,s=t[0],a=[];for(let e=0;e<s.length;e+=1)a[e]=ht(ut(t,s,e));const o=t=>L(a[t],1,1,(()=>{a[t]=null}));return{c(){e=u("div");for(let t=0;t<a.length;t+=1)a[t].c();m(e,"class","svelte-oizbqy")},m(t,s){l(t,e,s);for(let t=0;t<a.length;t+=1)a[t].m(e,null);n=!0},p(t,[n]){if(1&n){let i;for(s=t[0],i=0;i<s.length;i+=1){const o=ut(t,s,i);a[i]?(a[i].p(o,n),M(a[i],1)):(a[i]=ht(o),a[i].c(),M(a[i],1),a[i].m(e,null))}for(k(),i=s.length;i<a.length;i+=1)o(i);R()}},i(t){if(!n){for(let t=0;t<s.length;t+=1)M(a[t]);n=!0}},o(t){a=a.filter(Boolean);for(let t=0;t<a.length;t+=1)L(a[t]);n=!1},d(t){t&&r(e),c(a,t)}}}function pt(t,e,n){let s=[{name:"12345678",value:3},{name:"Bob",value:2}];return[s,t=>{n(0,s=t)}]}class mt extends G{constructor(t){super(),z(this,t,pt,dt,o,{updateScoreboard:1})}get updateScoreboard(){return this.$$.ctx[1]}}class ft{data;receptionTime;display;constructor(t,e,n){this.data=t,this.receptionTime=e,this.display=n}}class yt{data;interpolationBuffer=[];lastExtrapolatedPosition;constructor(t){this.data=t,this.lastExtrapolatedPosition={x:t.x,y:t.y}}}class gt{name;predictedPosition;controls;lastTimeShooting=-1;isPressingTrigger=!1;bullets=[];constructor(t){this.name=t.name,this.predictedPosition=t,this.controls={x:0,y:0,angle:0,messageNumber:0,deltaTime:0}}}class Pt{pendingInputs=[];bullets=[];structures={[WallType.BRICK]:[],[WallType.FENCE]:[],[WallType.NON_NEWTONIAN]:[]};players;myPlayer;lastGameTickMessageTime;lastGameTickMessage;constructor(t){this.players={[t]:new yt(CONSTANTS.CREATE_PLAYER(t))},this.myPlayer=new gt(CONSTANTS.CREATE_PLAYER(t)),this.lastGameTickMessageTime=Date.now(),this.lastGameTickMessage={players:[],newBullets:[]}}processGameTick(t){const e=Date.now();this.lastGameTickMessage=t,this.lastGameTickMessageTime=e,this.myPlayer.bullets=this.myPlayer.bullets.filter((e=>!t.deletedBullets[e.data.id])),this.bullets=this.bullets.filter((e=>!t.deletedBullets[e.data.id]));const n=window.innerWidth;for(const s of t.newBullets){const t=this.players[s.shooter];if(!t)break;const a=t.data;if(Q.showExtrapolatedEnemyPositions){const o={x:(t.lastExtrapolatedPosition.x+CONSTANTS.PLAYER_RADIUS*Math.cos(a.angle))*n,y:(t.lastExtrapolatedPosition.y+CONSTANTS.PLAYER_RADIUS*Math.sin(a.angle))*n};this.bullets.push(new ft(s,e,o))}else{const t=(a.x+CONSTANTS.PLAYER_RADIUS*Math.cos(a.angle))*window.innerWidth,n=(a.y+CONSTANTS.PLAYER_RADIUS*Math.sin(a.angle))*window.innerWidth;this.bullets.push(new ft(s,e,{x:t,y:n}))}}for(const n of t.players){this.players[n.name]||=new yt(n);const t=this.players[n.name];if(t.data=n,n.name===this.myPlayer.name){if(this.myPlayer.predictedPosition={...n,angle:this.myPlayer.controls.angle},CONSTANTS.DEV_MODE&&!Q.enableClientSidePrediction)continue;for(let t=0;t<this.pendingInputs.length;){const e=this.pendingInputs[t];e.messageNumber<=n.lastProcessedInput?this.pendingInputs.splice(t,1):(CONSTANTS.MOVE_PLAYER(this.myPlayer.predictedPosition,e),t++)}}else Q.showInterpolatedEnemyPositions&&t.interpolationBuffer.push([e,n])}}}const Tt={value:0,beginRetrieving(t){if(this.isRetrieving)throw"Please only call this function once.";this.isRetrieving=!0;const e=()=>{const e=Date.now();t.volatile.emit("ping",(()=>{this.value=Date.now()-e,t.volatile.emit("networkLatency",this.value)}))};setInterval(e,5e3),e()},isRetrieving:!1};class bt{timeCreated;data;endPoint;constructor(t,e,n){this.timeCreated=Date.now();const[s,a]=function(t,e,n,s){const a=CONSTANTS.BULLET_SPEED*Math.cos(t.angle)+e.x*CONSTANTS.PLAYER_SPEED,o=CONSTANTS.BULLET_SPEED*Math.sin(t.angle)+e.y*CONSTANTS.PLAYER_SPEED,i=t.x+CONSTANTS.PLAYER_RADIUS*Math.cos(t.angle),l=t.y+CONSTANTS.PLAYER_RADIUS*Math.sin(t.angle),r=[t,{x:i+2e4*a,y:l+2e4*o}],[[c,u],h,d]=s.reduce((([t,e,n],s)=>{const a=CONSTANTS.LINE_SEGMENT_INTERSECTION_POINT(s,r);if(!a)return[t,e,n];const o=distance(a[0],a[1],i,l);return o<e?[a,o,s]:[t,e,n]}),[[69,420],1/0,null]);return[{x:i,y:l,speedX:a,speedY:o,id:n,shooter:t.name,expirationDistance:h},{x:c,y:u}]}(t,e,Math.random()+":"+t.name,n);this.data=s,this.endPoint=a}}class St{state;socket;canSendIdleInput=!0;constructor(t,e){this.state=t,this.socket=e}processInputs(t,e){this.state.myPlayer.controls.deltaTime=t;const{x:n,y:s}=this.state.myPlayer.predictedPosition;CONSTANTS.MOVE_PLAYER(this.state.myPlayer.predictedPosition,this.state.myPlayer.controls);const{x:a,y:o}=this.state.myPlayer.predictedPosition,i=this.state.structures,l=i[WallType.BRICK].concat(i[WallType.FENCE]),[r,c]=CONSTANTS.GET_PLAYER_POSITION_AFTER_WALL_COLLISION(n,s,a,o,l),{x:u,y:h}=this.state.myPlayer.controls;let d=!1;if(a!==r||o!==c){this.state.myPlayer.predictedPosition.x=r,this.state.myPlayer.predictedPosition.y=c;const e=(r-n)/(t*CONSTANTS.PLAYER_SPEED),a=(c-s)/(t*CONSTANTS.PLAYER_SPEED),o=e**2+a**2,i=Math.min(Math.sqrt(1/o),1);this.state.myPlayer.controls.x=e*i,this.state.myPlayer.controls.y=a*i,d=!0}if(this.state.myPlayer.isPressingTrigger&&CONSTANTS.CAN_SHOOT(e,this.state.myPlayer.lastTimeShooting)){this.state.myPlayer.lastTimeShooting=e;const t=this.state.structures,n=t[WallType.BRICK].concat(t[WallType.NON_NEWTONIAN]),s=new bt(this.state.myPlayer.predictedPosition,this.state.myPlayer.controls,n);Q.enableClientSidePrediction&&this.state.myPlayer.bullets.push(s),this.state.myPlayer.controls.requestedBullet=s.data}const p=0!==this.state.myPlayer.controls.x||0!==this.state.myPlayer.controls.y||this.state.myPlayer.isPressingTrigger;(p||this.canSendIdleInput)&&(this.sendInputsToServer(this.state.myPlayer.controls),this.canSendIdleInput=!1,d&&(this.state.myPlayer.controls.x=u,this.state.myPlayer.controls.y=h)),p&&(this.canSendIdleInput=!0)}moveJoystick(t,e){this.state.myPlayer.controls.x=t,this.state.myPlayer.controls.y=e}adjustAim(t,e){this.state.myPlayer.controls.angle=this.state.players[this.state.myPlayer.name].data.angle=this.state.myPlayer.predictedPosition.angle=t,this.state.myPlayer.isPressingTrigger=e}sendInputsToServer(t){this.state.pendingInputs.push({...t}),this.socket.emit("controlsInput",t),t.messageNumber++,t.requestedBullet=void 0}}const xt=CONSTANTS.PLAYER_RADIUS*window.innerWidth;class Et{canvas;ctx;state;constructor(t,e){this.canvas=t,this.ctx=t.getContext("2d"),this.state=e}render(t,e){const n=this.canvas.width,s=this.canvas.height;this.ctx.clearRect(0,0,n,s),this.drawWalls(n,s);const a=t-this.state.lastGameTickMessageTime;for(const n in this.state.players){if(n===this.state.myPlayer.name)continue;const s=this.state.players[n];if(Q.showExtrapolatedEnemyPositions){const n=this.getExtrapolatedPlayer(s,a,e);this.drawPlayer(n,t)}if(Q.showInterpolatedEnemyPositions){const e=CONSTANTS.INTERPOLATE_PLAYER_POSITION(s.data,t,s.interpolationBuffer);this.drawPlayer(e,t,"blue")}Q.showUninterpolatedEnemyPositions&&this.drawPlayer(s.data,t,"red")}if(Q.showServerPlayer&&this.drawPlayer(this.state.players[this.state.myPlayer.name].data,t,"purple"),Q.showPredictedPlayer&&this.drawPlayer(this.state.myPlayer.predictedPosition,t),Q.showWhatOtherClientsPredict){const n=this.getExtrapolatedPlayer(this.state.players[this.state.myPlayer.name],a,e);this.drawPlayer(n,t,"cyan")}Q.showClientBullet&&(this.ctx.fillStyle="#770",this.state.bullets=this.state.bullets.filter((e=>{const a=t-e.receptionTime,o=e.data.x+e.data.speedX*a,i=e.data.y+e.data.speedY*a,l=o*n,r=i*s;return this.circle(l,r,2),0<=o&&o<=1&&0<=i&&i<=1}))),Q.showIdealClientBullet&&(this.ctx.fillStyle="#00f",this.state.bullets=this.state.bullets.filter((e=>{if(e.data.shooter===this.state.myPlayer.name)return!1;const a=t-e.receptionTime,o=e.data.x+e.data.speedX*a,i=e.data.y+e.data.speedY*a,l=o*n,r=i*s,c=.001*Math.min(t-e.receptionTime,500)/.5,u=e.display.x+a*e.data.speedX*n,h=e.display.y+a*e.data.speedY*s,d=u+(l-u)*c,p=h+(r-h)*c,m=-(this.state.players[e.data.shooter]?.data.latency||0);return!(distance(e.data.x+e.data.speedX*m,e.data.y+e.data.speedY*m,d/n,p/s)>=e.data.expirationDistance)&&(this.circle(d,p,2),0<=o&&o<=1&&0<=i&&i<=1)}))),Q.showClientPredictedBullet&&(this.state.myPlayer.bullets=this.state.myPlayer.bullets.filter((e=>{const a=t-e.timeCreated,o=e.data,i=o.x+o.speedX*a,l=o.y+o.speedY*a,r=i*n,c=l*s;return!(distance(o.x,o.y,i,l)>=o.expirationDistance)&&(this.ctx.fillStyle="#c0c",this.circle(r,c,2),0<=i&&i<=1&&0<=l&&l<=1)})))}drawPlayer(t,e,n="#333"){const[s,a]=[t.x*this.canvas.width,t.y*this.canvas.height],o=e-t.lastTimeGettingShot,i=o<=255;if(this.ctx.fillStyle=this.ctx.strokeStyle=i?`rgb(255,${o},${o})`:n,t.name===this.state.myPlayer.name&&i){const t=50+200*Math.random();throttled(vt,t,e)}this.circle(s,a,xt,!i);const[l,r]=[s+xt*Math.cos(t.angle),a+xt*Math.sin(t.angle)];this.circle(l,r,2),this.ctx.fillStyle="#40f",this.ctx.fillText(t.name,s-17,a-17)}drawWalls(t,e){const n=[["#0e8",WallType.NON_NEWTONIAN],["#44f",WallType.FENCE],["#410",WallType.BRICK]];for(const[s,a]of n){this.ctx.strokeStyle=s;for(const[n,s]of this.state.structures[a])this.line(n.x*t,n.y*e,s.x*t,s.y*e)}}circle(t,e,n,s){this.ctx.beginPath(),this.ctx.arc(t,e,n,0,7),this.ctx[s?"stroke":"fill"](),this.ctx.closePath()}line(t,e,n,s){this.ctx.beginPath(),this.ctx.moveTo(t,e),this.ctx.lineTo(n,s),this.ctx.stroke(),this.ctx.closePath()}getExtrapolatedPlayer(t,e,n){const s=e+t.data.latency,{x:a,y:o}=t.data,i=CONSTANTS.EXTRAPOLATE_PLAYER_POSITION(t.data,s),{x:l,y:r}=t.lastExtrapolatedPosition,c=distance(i.x,i.y,l,r)/n;if(c>1.5*CONSTANTS.PLAYER_SPEED){const t=1.5*CONSTANTS.PLAYER_SPEED/c,e=i.x-l,n=i.y-r;i.x=l+e*t,i.y=r+n*t}t.lastExtrapolatedPosition=i;const u=this.state.structures,h=u[WallType.BRICK].concat(u[WallType.FENCE]),[d,p]=CONSTANTS.GET_PLAYER_POSITION_AFTER_WALL_COLLISION(a,o,i.x,i.y,h);return{...i,x:d,y:p}}}function vt(){const t=document.body.classList,e=document.getElementById("bloodscreen").classList;t.toggle("shake",!e.toggle("bleed")),e.toggle("bleed2",!t.toggle("shake2"))}let Nt=!1;let wt=0;function $t(t){let e,n,s,a,o,c,p,y,g,P,T,b,x,v;function N(e){t[6].call(null,e)}let w={};void 0!==t[2]&&(w.updateScoreboard=t[2]),a=new mt({props:w}),S.push((()=>function(t,e,n){const s=t.$$.props[e];void 0!==s&&(t.$$.bound[s]=n,n(t.$$.ctx[s]))}(a,"updateScoreboard",N))),P=new J({props:{callback:t[3].moveJoystick.bind(t[3])}});let $=t[4]&&function(t){let e,n;return e=new it({}),{c(){D(e.$$.fragment)},m(t,s){Y(e,t,s),n=!0},i(t){n||(M(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){B(e,t)}}}();return x=new H({props:{callback:t[3].adjustAim.bind(t[3])}}),{c(){e=u("center"),n=h(t[0]),s=d(),D(a.$$.fragment),c=d(),p=u("canvas"),y=d(),g=u("div"),D(P.$$.fragment),T=d(),$&&$.c(),b=d(),D(x.$$.fragment),m(e,"class","svelte-znqoos"),m(p,"class","svelte-znqoos"),m(g,"class","input-container svelte-znqoos")},m(o,r){l(o,e,r),i(e,n),l(o,s,r),Y(a,o,r),l(o,c,r),l(o,p,r),t[7](p),l(o,y,r),l(o,g,r),Y(P,g,null),i(g,T),$&&$.m(g,null),i(g,b),Y(x,g,null),v=!0},p(t,[e]){(!v||1&e)&&f(n,t[0]);const s={};var i;!o&&4&e&&(o=!0,s.updateScoreboard=t[2],i=()=>o=!1,E.push(i)),a.$set(s)},i(t){v||(M(a.$$.fragment,t),M(P.$$.fragment,t),M($),M(x.$$.fragment,t),v=!0)},o(t){L(a.$$.fragment,t),L(P.$$.fragment,t),L($),L(x.$$.fragment,t),v=!1},d(n){n&&r(e),n&&r(s),B(a,n),n&&r(c),n&&r(p),t[7](null),n&&r(y),n&&r(g),B(P),$&&$.d(),B(x)}}}function At(t,e,n){let s,a,{socket:o}=e,{username:i}=e;Tt.beginRetrieving(o);const l=new Pt(i),r=new St(l,o);T((()=>function(t,e,n){if(Nt)throw"The client is already running.";Nt=!0,CONSTANTS.DEV_MODE&&(window.state=e),t.canvas.height=t.canvas.width=window.innerWidth;const s=new Et(t.canvas,e);n.on("mapdata",(t=>{console.log("got the mapdata"),e.structures=t})),n.on("removedPlayer",(t=>{delete e.players[t]})),n.on("gameTick",(t=>{e.processGameTick(t)})),function n(a){const o=Date.now(),i=o-(a||o);requestAnimationFrame((()=>n(o))),t.inputs.processInputs(i,o),s.render(o,i);const l=Object.values(e.players).sort(((t,e)=>e.data.score-t.data.score)).map((t=>({name:t.data.name,value:t.data.score}))).slice(0,5);t.updateScoreboard(l)}()}({inputs:r,canvas:s,updateScoreboard:a},l,o)));const c=CONSTANTS.DEV_MODE;return t.$set=t=>{"socket"in t&&n(5,o=t.socket),"username"in t&&n(0,i=t.username)},[i,s,a,r,c,o,function(t){a=t,n(2,a)},function(t){S[t?"unshift":"push"]((()=>{s=t,n(1,s)}))}]}Object.assign(window,{startBot:function(){clearInterval(wt);const[t,e,n,s]=[...document.querySelector(".input-container").children];if(!t||!s)throw"Something changed here that caused this to throw.";s.ontouchstart(),t.ontouchstart({targetTouches:[{clientX:0,clientY:0}]}),t.ontouchmove({targetTouches:[{clientX:0,clientY:100}]});let a=1;wt=window.setInterval((()=>{t.ontouchmove({targetTouches:[{clientX:0,clientY:100*(a*=-1)}]})}),5e3)},endBot:function(){clearTimeout(wt)}});class Ct extends G{constructor(t){super(),z(this,t,At,$t,o,{socket:5,username:0})}}function Ot(t){let e,n;return e=new Ct({props:{socket:t[2],username:t[1]}}),{c(){D(e.$$.fragment)},m(t,s){Y(e,t,s),n=!0},p(t,n){const s={};2&n&&(s.username=t[1]),e.$set(s)},i(t){n||(M(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){B(e,t)}}}function _t(t){let e,n;return e=new j({props:{proceed:t[3],socket:t[2],blaze:t[0]}}),{c(){D(e.$$.fragment)},m(t,s){Y(e,t,s),n=!0},p(t,n){const s={};1&n&&(s.blaze=t[0]),e.$set(s)},i(t){n||(M(e.$$.fragment,t),n=!0)},o(t){L(e.$$.fragment,t),n=!1},d(t){B(e,t)}}}function It(t){let e,n,s,a,o,i,c;const p=[_t,Ot],f=[];function y(t,e){return 0===t[1].length?0:1}s=y(t),a=f[s]=p[s](t);let g=t[4]&&function(t){let e;return{c(){e=u("div"),m(e,"id","debug-window"),m(e,"class","svelte-yuxzpj")},m(t,n){l(t,e,n)},d(t){t&&r(e)}}}();return{c(){e=u("div"),n=d(),a.c(),o=d(),g&&g.c(),i=h(""),m(e,"id","bloodscreen"),m(e,"class","svelte-yuxzpj")},m(t,a){l(t,e,a),l(t,n,a),f[s].m(t,a),l(t,o,a),g&&g.m(t,a),l(t,i,a),c=!0},p(t,[e]){let n=s;s=y(t),s===n?f[s].p(t,e):(k(),L(f[n],1,1,(()=>{f[n]=null})),R(),a=f[s],a||(a=f[s]=p[s](t),a.c()),M(a,1),a.m(o.parentNode,o))},i(t){c||(M(a),c=!0)},o(t){L(a),c=!1},d(t){t&&r(e),t&&r(n),f[s].d(t),t&&r(o),g&&g.d(t),t&&r(i)}}}function kt(t,e,n){let{blaze:s}=e;const a=io({transports:["websocket"],upgrade:!1});let o="";const i=CONSTANTS.DEV_MODE;return t.$set=t=>{"blaze"in t&&n(0,s=t.blaze)},[s,o,a,function(t){n(1,o=t),console.log("Welcome to the game,",t+"!")},i]}return new class extends G{constructor(t){super(),z(this,t,kt,It,o,{blaze:0})}}({target:document.body,props:{blaze:"Blaze"}})}();
//# sourceMappingURL=bundle.js.map
