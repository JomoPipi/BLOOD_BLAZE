var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function s(t){t.forEach(e)}function a(t){return"function"==typeof t}function o(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function i(t,e,n,s){return t[1]&&s?function(t,e){for(const n in e)t[n]=e[n];return t}(n.ctx.slice(),t[1](s(e))):n.ctx}function r(t,e,n,s,a,o,r){const l=function(t,e,n,s){if(t[2]&&s){const a=t[2](s(n));if(void 0===e.dirty)return a;if("object"==typeof a){const t=[],n=Math.max(e.dirty.length,a.length);for(let s=0;s<n;s+=1)t[s]=e.dirty[s]|a[s];return t}return e.dirty|a}return e.dirty}(e,s,a,o);if(l){const a=i(e,n,s,r);t.p(a,l)}}function l(t,e){t.appendChild(e)}function c(t,e,n){t.insertBefore(e,n||null)}function u(t){t.parentNode.removeChild(t)}function d(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function h(t){return document.createElement(t)}function m(t){return document.createTextNode(t)}function p(){return m(" ")}function f(){return m("")}function y(t,e,n,s){return t.addEventListener(e,n,s),()=>t.removeEventListener(e,n,s)}function g(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function T(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function P(t,e,n,s){t.style.setProperty(e,n,s?"important":"")}function b(t,e,n){t.classList[n?"add":"remove"](e)}let $;function x(t){$=t}function S(t){(function(){if(!$)throw new Error("Function called outside component initialization");return $})().$$.on_mount.push(t)}const w=[],v=[],E=[],N=[],A=Promise.resolve();let k=!1;function _(t){E.push(t)}let O=!1;const C=new Set;function I(){if(!O){O=!0;do{for(let t=0;t<w.length;t+=1){const e=w[t];x(e),M(e.$$)}for(w.length=0;v.length;)v.pop()();for(let t=0;t<E.length;t+=1){const e=E[t];C.has(e)||(C.add(e),e())}E.length=0}while(w.length);for(;N.length;)N.pop()();k=!1,O=!1,C.clear()}}function M(t){if(null!==t.fragment){t.update(),s(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(_)}}const R=new Set;let L,D,B;function W(){L={r:0,c:[],p:L}}function Y(){L.r||s(L.c),L=L.p}function z(t,e){t&&t.i&&(R.delete(t),t.i(e))}function G(t,e,n,s){if(t&&t.o){if(R.has(t))return;R.add(t),L.c.push((()=>{R.delete(t),s&&(n&&t.d(1),s())})),t.o(e)}}function j(t){t&&t.c()}function q(t,n,o){const{fragment:i,on_mount:r,on_destroy:l,after_update:c}=t.$$;i&&i.m(n,o),_((()=>{const n=r.map(e).filter(a);l?l.push(...n):s(n),t.$$.on_mount=[]})),c.forEach(_)}function U(t,e){const n=t.$$;null!==n.fragment&&(s(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function X(t,e){-1===t.$$.dirty[0]&&(w.push(t),k||(k=!0,A.then(I)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function H(e,a,o,i,r,l,c=[-1]){const d=$;x(e);const h=a.props||{},m=e.$$={fragment:null,ctx:null,props:l,update:t,not_equal:r,bound:n(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(d?d.$$.context:[]),callbacks:n(),dirty:c};let p=!1;if(m.ctx=o?o(e,h,((t,n,...s)=>{const a=s.length?s[0]:n;return m.ctx&&r(m.ctx[t],m.ctx[t]=a)&&(m.bound[t]&&m.bound[t](a),p&&X(e,t)),n})):[],m.update(),p=!0,s(m.before_update),m.fragment=!!i&&i(m.ctx),a.target){if(a.hydrate){const t=function(t){return Array.from(t.childNodes)}(a.target);m.fragment&&m.fragment.l(t),t.forEach(u)}else m.fragment&&m.fragment.c();a.intro&&z(e.$$.fragment),q(e,a.target,a.anchor),I()}x(d)}class F{$destroy(){U(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(){}}const K=[...Array(29)],V=[...Array(1)];const Z={gunshot:function(){if(!D)return;const t=D.createBufferSource(),e=D.currentTime;t.buffer=V[Math.random()*V.length|0],t.connect(B),t.start(e)},injury:function(){if(!D)return;const t=D.createBufferSource(),e=D.currentTime;t.buffer=K[Math.random()*K.length|0],t.connect(B),t.start(e)},initialize:function(){D=new AudioContext,B=D.createGain(),B.connect(D.destination),B.gain.value=.5;const t=D.createOscillator();t.connect(B),t.start(D.currentTime),t.stop(D.currentTime+1e-4),K.forEach(((t,e)=>{const n=new XMLHttpRequest;n.open("GET",`../../../../public/sounds/bullet-injury/${e}.wav`),n.responseType="arraybuffer",n.onload=function(){const t=n.response;D.decodeAudioData(t,(t=>{K[e]=t}))},n.send()})),V.forEach(((t,e)=>{const n=new XMLHttpRequest;n.open("GET",`../../../../public/sounds/gunshots/${e}.wav`),n.responseType="arraybuffer",n.onload=function(){const t=n.response;D.decodeAudioData(t,(t=>{V[e]=t}))},n.send()}))}};function J(e){let n,a,o,i,r,d,f,P,b,$,x,S,w,v,E,N,A,k,_,O,C,I,M;return{c(){n=h("main"),a=h("span"),o=h("h1"),i=h("span"),i.textContent="BLOOD",r=p(),d=h("span"),f=m(e[0]),P=p(),b=h("h2"),b.textContent="A Devastating Bloodbath of Boundless Mortality",$=p(),x=h("span"),S=h("form"),w=h("input"),v=p(),E=h("button"),E.textContent="GO",N=p(),A=h("h3"),A.textContent="last update - 10/14/2021",k=p(),_=h("span"),O=p(),C=h("bloodblaze"),g(i,"class","_1 svelte-q5dme9"),g(d,"class","_2 svelte-q5dme9"),g(o,"class","svelte-q5dme9"),g(b,"class","svelte-q5dme9"),g(a,"class","title svelte-q5dme9"),g(w,"autocomplete","off"),g(w,"placeholder","Enter something here..."),g(w,"pattern","[A-Za-z0-9 _]*"),g(w,"maxlength",e[3]),g(w,"class","svelte-q5dme9"),g(E,"class","svelte-q5dme9"),g(A,"class","svelte-q5dme9"),g(S,"type","text"),g(S,"action",""),g(C,"class","svelte-q5dme9"),g(x,"class","inner svelte-q5dme9"),g(n,"class","svelte-q5dme9")},m(t,s){c(t,n,s),l(n,a),l(a,o),l(o,i),l(o,r),l(o,d),l(d,f),l(a,P),l(a,b),l(n,$),l(n,x),l(x,S),l(S,w),e[7](w),l(S,v),l(S,E),l(S,N),l(S,A),l(x,k),l(x,_),l(x,O),l(x,C),I||(M=[y(w,"keyup",e[4]),y(S,"submit",e[2])],I=!0)},p(t,[e]){1&e&&T(f,t[0])},i:t,o:t,d(t){t&&u(n),e[7](null),I=!1,s(M)}}}function Q(t,e,n){let s,{proceed:a}=e,{blaze:o}=e,{socket:i}=e;function r(t){t.preventDefault();const e=t.target.children[0];e.value&&(i.emit("nomination",e.value),e.value="")}S((()=>{i.on("nomination",(([t,e])=>{t&&(i.removeAllListeners("nomination"),a(e)),alert(t?`Welcome, ${e}!`:`Sorry, "${e}" is not available.`)})),i.on("error",(t=>{document.body.innerHTML+=t})),CONSTANTS.DEV_MODE&&i.emit("nomination",Math.random().toString())})),Object.assign(window,{tryUsername:r});const l=CONSTANTS.USERNAME_CHARACTER_LIMIT;let c=!0;return t.$set=t=>{"proceed"in t&&n(5,a=t.proceed),"blaze"in t&&n(0,o=t.blaze),"socket"in t&&n(6,i=t.socket)},[o,s,r,l,function(t){c&&(c=!1,Z.initialize()),t.target.value=t.target.value.replace(/[^A-Za-z0-9 _]/g,"").slice(0,l)},a,i,function(t){v[t?"unshift":"push"]((()=>{s=t,n(1,s)}))}]}class tt extends F{constructor(t){super(),H(this,t,Q,J,o,{proceed:5,blaze:0,socket:6})}}function et(e){let n;return{c(){n=h("canvas"),g(n,"id","mobile-game-trigger"),g(n,"class","svelte-eupre8")},m(t,s){c(t,n,s),e[2](n)},p:t,i:t,o:t,d(t){t&&u(n),e[2](null)}}}function nt(t,e,n){let s,a,o,i;const r=window.innerWidth/2.5/PHI;let{callback:l=(()=>0)}=e,c=0;function u(){i.clearRect(0,0,a,o),i.strokeStyle="rgb(225, 198, 228)",i.lineWidth=2;const[t,e]=[40*Math.cos(c)+a/2,40*Math.sin(c)+o/2],[n,s]=[10*Math.cos(c)+a/2,10*Math.sin(c)+o/2];i.beginPath(),i.arc(a/2,o/2,40,0,7),i.closePath(),i.moveTo(t,e),i.lineTo(n,s),i.stroke(),i.beginPath()}return S((()=>{a=n(0,s.width=o=n(0,s.height=r,s),s),i=s.getContext("2d"),n(0,s.style.margin="5px",s),n(0,s.style.backgroundColor="transparent",s),u(),n(0,s.ontouchstart=()=>l(c,!0),s),n(0,s.ontouchmove=function(t){const e=+s.offsetLeft,n=+s.offsetTop,i=t.targetTouches[0].clientX-e-a/2,r=t.targetTouches[0].clientY-n-o/2,d=Math.atan2(r,i);c=d,u(),l(d,!0)},s),n(0,s.ontouchend=()=>l(c,!1),s)})),t.$set=t=>{"callback"in t&&n(1,l=t.callback)},[s,l,function(t){v[t?"unshift":"push"]((()=>{s=t,n(0,s)}))}]}class st extends F{constructor(t){super(),H(this,t,nt,et,o,{callback:1})}}function at(e){let n,s;return{c(){n=h("div"),s=h("canvas"),g(s,"class","svelte-9dbomt"),g(n,"id","mobile-game-joystick"),g(n,"class","svelte-9dbomt")},m(t,a){c(t,n,a),l(n,s),e[3](s),e[4](n)},p:t,i:t,o:t,d(t){t&&u(n),e[3](null),e[4](null)}}}function ot(t,e,n){let s,a,o,i,r,l;const c=window.innerWidth/2.5/PHI;let{callback:u=(()=>0)}=e;function d(){r.clearRect(0,0,o,i),r.strokeStyle="black",r.lineWidth=8,r.fillStyle="rgb(71, 61, 61)",r.beginPath();const[t,e]=l;r.arc(t,e,40,0,7),r.closePath(),r.stroke(),r.fill();const s=t-o/2,c=e-i/2,u=1.2*Math.PI/4;n(1,a.style.transform=`\n        perspective(200px) \n        rotateY(${u*s|0}deg)\n        rotateX(${-u*c|0}deg)`,a)}return S((()=>{n(0,s.style.width=n(0,s.style.height=Math.round(c)+"px",s),s),o=n(1,a.width=i=n(1,a.height=Math.round(1.5*c),a),a);const t=.5*Math.floor(c-1.5*c);n(1,a.style.left=n(1,a.style.top=t+"px",a),a),r=a.getContext("2d"),l=[o/2,i/2],d(),n(0,s.ontouchstart=function(t){e=t.targetTouches[0].clientX,h=t.targetTouches[0].clientY},s),n(0,s.ontouchmove=function(t){const n=.75*(t.targetTouches[0].clientX-e),s=.75*(t.targetTouches[0].clientY-h),a=o/2-40-8,i=Math.pow(a,2),r=Math.pow(n,2)+Math.pow(s,2),c=Math.sqrt(i/r),[m,p]=r>i?[n*c,s*c]:[n,s];l[0]=m+o/2,l[1]=p+o/2,d();u(m/a,p/a)},s),n(0,s.ontouchend=function(){l[0]=o/2,l[1]=i/2,d(),u(0,0)},s);let e=0,h=0})),t.$set=t=>{"callback"in t&&n(2,u=t.callback)},[s,a,u,function(t){v[t?"unshift":"push"]((()=>{a=t,n(1,a)}))},function(t){v[t?"unshift":"push"]((()=>{s=t,n(0,s)}))}]}class it extends F{constructor(t){super(),H(this,t,ot,at,o,{callback:2})}}const rt={enableClientSidePrediction:!0,showPredictedPlayer:!0,showServerPlayer:!1,showClientBullet:!1,showIdealClientBullet:!0,showClientPredictedBullet:!0,showExtrapolatedEnemyPositions:!0,showInterpolatedEnemyPositions:!1,showUninterpolatedEnemyPositions:!1,showWhatOtherClientsPredict:!1,showGameMetadeta:!0};function lt(t){let e,n,o,d,f,P,$,x,S;const w=t[3].default,v=function(t,e,n,s){if(t){const a=i(t,e,n,s);return t[0](a)}}(w,t,t[2],null);return{c(){e=h("button"),n=m(t[0]),o=p(),d=h("div"),f=h("button"),f.textContent="back",P=p(),v&&v.c(),g(e,"class","settings-button svelte-1jvwz97"),g(d,"class","settings-page svelte-1jvwz97"),b(d,"show",t[1].isOpen)},m(s,i){c(s,e,i),l(e,n),c(s,o,i),c(s,d,i),l(d,f),l(d,P),v&&v.m(d,null),$=!0,x||(S=[y(e,"click",(function(){a(t[1].toggle)&&t[1].toggle.apply(this,arguments)})),y(f,"click",(function(){a(t[1].toggle)&&t[1].toggle.apply(this,arguments)}))],x=!0)},p(e,[s]){t=e,(!$||1&s)&&T(n,t[0]),v&&v.p&&4&s&&r(v,w,t,t[2],s,null,null),2&s&&b(d,"show",t[1].isOpen)},i(t){$||(z(v,t),$=!0)},o(t){G(v,t),$=!1},d(t){t&&u(e),t&&u(o),t&&u(d),v&&v.d(t),x=!1,s(S)}}}function ct(t,e,n){let{btnText:s}=e;const a={toggle(){n(1,a.isOpen^=1,a)},isOpen:0};let{$$slots:o={},$$scope:i}=e;return t.$set=t=>{"btnText"in t&&n(0,s=t.btnText),"$$scope"in t&&n(2,i=t.$$scope)},[s,a,i,o]}class ut extends F{constructor(t){super(),H(this,t,ct,lt,o,{btnText:0})}}function dt(t,e,n){const s=t.slice();return s[3]=e[n],s}function ht(t){let e,n,s,a,o,i,r,d,f,T,P,b,$=t[3].split(ft).map(yt).join(" ")+"";function x(){t[2].call(i,t[3])}return{c(){e=h("br"),n=p(),s=h("br"),a=p(),o=h("label"),i=h("input"),r=p(),d=h("h4"),f=m($),T=p(),g(i,"type","checkbox"),g(d,"class","svelte-1ppm1ft")},m(u,h){c(u,e,h),c(u,n,h),c(u,s,h),c(u,a,h),c(u,o,h),l(o,i),i.checked=t[0][t[3]],l(o,r),l(o,d),l(d,f),l(o,T),P||(b=y(i,"change",x),P=!0)},p(e,n){t=e,3&n&&(i.checked=t[0][t[3]])},d(t){t&&u(e),t&&u(n),t&&u(s),t&&u(a),t&&u(o),P=!1,b()}}}function mt(t){let e,n=t[1],s=[];for(let e=0;e<n.length;e+=1)s[e]=ht(dt(t,n,e));return{c(){for(let t=0;t<s.length;t+=1)s[t].c();e=f()},m(t,n){for(let e=0;e<s.length;e+=1)s[e].m(t,n);c(t,e,n)},p(t,a){if(3&a){let o;for(n=t[1],o=0;o<n.length;o+=1){const i=dt(t,n,o);s[o]?s[o].p(i,a):(s[o]=ht(i),s[o].c(),s[o].m(e.parentNode,e))}for(;o<s.length;o+=1)s[o].d(1);s.length=n.length}},d(t){d(s,t),t&&u(e)}}}function pt(t){let e,n;return e=new ut({props:{btnText:"⚙️",$$slots:{default:[mt]},$$scope:{ctx:t}}}),{c(){j(e.$$.fragment)},m(t,s){q(e,t,s),n=!0},p(t,[n]){const s={};65&n&&(s.$$scope={dirty:n,ctx:t}),e.$set(s)},i(t){n||(z(e.$$.fragment,t),n=!0)},o(t){G(e.$$.fragment,t),n=!1},d(t){U(e,t)}}}const ft=/([A-Z]+|[A-Z]?[a-z]+)(?=[A-Z]|\b)/,yt=t=>t[0]?t[0].toUpperCase()+t.slice(1):t;function gt(t,e,n){const s=Object.keys(rt).filter((t=>"boolean"==typeof rt[t]));return[rt,s,function(t){rt[t]=this.checked,n(0,rt),n(1,s)}]}class Tt extends F{constructor(t){super(),H(this,t,gt,pt,o,{})}}function Pt(e){let n,s,a,o;return{c(){n=h("h4"),s=m(e[0]),a=m(" - "),o=m(e[1]),g(n,"class","svelte-9w6kgf")},m(t,i){c(t,n,i),l(n,s),l(n,a),l(n,o),e[4](n)},p(t,[e]){1&e&&T(s,t[0]),2&e&&T(o,t[1])},i:t,o:t,d(t){t&&u(n),e[4](null)}}}function bt(t,e,n){let s,{name:a}=e,{value:o}=e,{maximum:i}=e,r=!1;return S((()=>{n(2,s.style.background=`linear-gradient(to right, #39f ${Math.round(100*o/i)}%, #111 0%)`,s),n(5,r=!0)})),t.$set=t=>{"name"in t&&n(0,a=t.name),"value"in t&&n(1,o=t.value),"maximum"in t&&n(3,i=t.maximum)},t.$$.update=()=>{42&t.$$.dirty&&r&&n(2,s.style.background=`linear-gradient(to right, #39f ${Math.round(100*o/i)}%, #111 0%)`,s)},[a,o,s,i,function(t){v[t?"unshift":"push"]((()=>{s=t,n(2,s),n(5,r),n(1,o),n(3,i)}))}]}class $t extends F{constructor(t){super(),H(this,t,bt,Pt,o,{name:0,value:1,maximum:3})}}function xt(t,e,n){const s=t.slice();return s[2]=e[n],s}function St(t){let e,n;return e=new $t({props:{name:t[2].name,value:t[2].value,maximum:t[0][0]?.value||0}}),{c(){j(e.$$.fragment)},m(t,s){q(e,t,s),n=!0},p(t,n){const s={};1&n&&(s.name=t[2].name),1&n&&(s.value=t[2].value),1&n&&(s.maximum=t[0][0]?.value||0),e.$set(s)},i(t){n||(z(e.$$.fragment,t),n=!0)},o(t){G(e.$$.fragment,t),n=!1},d(t){U(e,t)}}}function wt(t){let e,n,s=t[0],a=[];for(let e=0;e<s.length;e+=1)a[e]=St(xt(t,s,e));const o=t=>G(a[t],1,1,(()=>{a[t]=null}));return{c(){e=h("div");for(let t=0;t<a.length;t+=1)a[t].c();g(e,"class","svelte-1rg865m")},m(t,s){c(t,e,s);for(let t=0;t<a.length;t+=1)a[t].m(e,null);n=!0},p(t,[n]){if(1&n){let i;for(s=t[0],i=0;i<s.length;i+=1){const o=xt(t,s,i);a[i]?(a[i].p(o,n),z(a[i],1)):(a[i]=St(o),a[i].c(),z(a[i],1),a[i].m(e,null))}for(W(),i=s.length;i<a.length;i+=1)o(i);Y()}},i(t){if(!n){for(let t=0;t<s.length;t+=1)z(a[t]);n=!0}},o(t){a=a.filter(Boolean);for(let t=0;t<a.length;t+=1)G(a[t]);n=!1},d(t){t&&u(e),d(a,t)}}}function vt(t,e,n){let s=[{name:"12345678",value:3},{name:"Bob",value:2}];return[s,t=>{n(0,s=t)}]}class Et extends F{constructor(t){super(),H(this,t,vt,wt,o,{updateScoreboard:1})}get updateScoreboard(){return this.$$.ctx[1]}}class Nt{data;receptionTime;display;constructor(t,e,n){this.data=t,this.receptionTime=e,this.display=n}}class At{data;interpolationBuffer=[];lastExtrapolatedPosition;constructor(t){this.data=t,this.lastExtrapolatedPosition={x:t.x,y:t.y}}}class kt{name;predictedPosition;controls;lastTimeShooting=-1;isPressingTrigger=!1;bullets=[];constructor(t){this.name=t.name,this.predictedPosition=t,this.controls={x:0,y:0,angle:0,messageNumber:0,deltaTime:0}}}class _t{pendingInputs=[];bullets=[];structures={[WallType.BRICK]:[],[WallType.FENCE]:[],[WallType.NON_NEWTONIAN]:[]};players;myPlayer;lastGameTickMessageTime;lastGameTickMessage;constructor(t){this.players={[t]:new At(CONSTANTS.CREATE_PLAYER(t))},this.myPlayer=new kt(CONSTANTS.CREATE_PLAYER(t)),this.lastGameTickMessageTime=Date.now(),this.lastGameTickMessage={players:[],newBullets:[]}}processGameTick(t){const e=Date.now();this.lastGameTickMessage=t,this.lastGameTickMessageTime=e,this.myPlayer.bullets=this.myPlayer.bullets.filter((e=>!t.deletedBullets[e.data.id])),this.bullets=this.bullets.filter((e=>!t.deletedBullets[e.data.id]));const n=window.innerWidth;for(const s of t.newBullets){const t=this.players[s.shooter];if(!t)break;const a=t.data;if(rt.showExtrapolatedEnemyPositions){const o={x:(t.lastExtrapolatedPosition.x+CONSTANTS.PLAYER_RADIUS*Math.cos(a.angle))*n,y:(t.lastExtrapolatedPosition.y+CONSTANTS.PLAYER_RADIUS*Math.sin(a.angle))*n};this.bullets.push(new Nt(s,e,o))}else{const t=(a.x+CONSTANTS.PLAYER_RADIUS*Math.cos(a.angle))*window.innerWidth,n=(a.y+CONSTANTS.PLAYER_RADIUS*Math.sin(a.angle))*window.innerWidth;this.bullets.push(new Nt(s,e,{x:t,y:n}))}}for(const n of t.players){this.players[n.name]||=new At(n);const t=this.players[n.name];if(t.data=n,n.name===this.myPlayer.name){if(this.myPlayer.predictedPosition={...n,angle:this.myPlayer.controls.angle},CONSTANTS.DEV_MODE&&!rt.enableClientSidePrediction)continue;for(let t=0;t<this.pendingInputs.length;){const e=this.pendingInputs[t];e.messageNumber<=n.lastProcessedInput?this.pendingInputs.splice(t,1):(CONSTANTS.MOVE_PLAYER(this.myPlayer.predictedPosition,e),t++)}}else rt.showInterpolatedEnemyPositions&&t.interpolationBuffer.push([e,n])}}}const Ot={value:0,beginRetrieving(t){if(this.isRetrieving)throw"Please only call this function once.";this.isRetrieving=!0;const e=()=>{const e=Date.now();t.volatile.emit("ping",(()=>{this.value=Date.now()-e,t.volatile.emit("networkLatency",this.value)}))};setInterval(e,5e3),e()},isRetrieving:!1};class Ct{timeCreated;data;endPoint;constructor(t,e,n){this.timeCreated=Date.now();const[s,a]=function(t,e,n,s){const a=CONSTANTS.BULLET_SPEED*Math.cos(t.angle)+e.x*CONSTANTS.PLAYER_SPEED,o=CONSTANTS.BULLET_SPEED*Math.sin(t.angle)+e.y*CONSTANTS.PLAYER_SPEED,i=t.x+CONSTANTS.PLAYER_RADIUS*Math.cos(t.angle),r=t.y+CONSTANTS.PLAYER_RADIUS*Math.sin(t.angle),l=[t,{x:i+2e4*a,y:r+2e4*o}],[[c,u],d,h]=s.reduce((([t,e,n],s)=>{const a=CONSTANTS.LINE_SEGMENT_INTERSECTION_POINT(s,l);if(!a)return[t,e,n];const o=distance(a[0],a[1],i,r);return o<e?[a,o,s]:[t,e,n]}),[[69,420],1/0,null]);return[{x:i,y:r,speedX:a,speedY:o,id:n,shooter:t.name,expirationDistance:d},{x:c,y:u}]}(t,e,Math.random()+":"+t.name,n);this.data=s,this.endPoint=a}}class It{state;socket;canSendIdleInput=!0;constructor(t,e){this.state=t,this.socket=e}processInputs(t,e){this.state.myPlayer.controls.deltaTime=t;const{x:n,y:s}=this.state.myPlayer.predictedPosition;CONSTANTS.MOVE_PLAYER(this.state.myPlayer.predictedPosition,this.state.myPlayer.controls);const{x:a,y:o}=this.state.myPlayer.predictedPosition,i=this.state.structures,r=i[WallType.BRICK].concat(i[WallType.FENCE]),[l,c]=CONSTANTS.GET_PLAYER_POSITION_AFTER_WALL_COLLISION(n,s,a,o,r),{x:u,y:d}=this.state.myPlayer.controls;let h=!1;if(a!==l||o!==c){this.state.myPlayer.predictedPosition.x=l,this.state.myPlayer.predictedPosition.y=c;const e=(l-n)/(t*CONSTANTS.PLAYER_SPEED),a=(c-s)/(t*CONSTANTS.PLAYER_SPEED),o=e**2+a**2,i=Math.min(Math.sqrt(1/o),1);this.state.myPlayer.controls.x=e*i,this.state.myPlayer.controls.y=a*i,h=!0}if(this.state.myPlayer.isPressingTrigger&&CONSTANTS.CAN_SHOOT(e,this.state.myPlayer.lastTimeShooting,this.state.players[this.state.myPlayer.name].data)){Z.gunshot(),this.state.myPlayer.lastTimeShooting=e;const t=this.state.structures,n=t[WallType.BRICK].concat(t[WallType.NON_NEWTONIAN]),s=new Ct(this.state.myPlayer.predictedPosition,this.state.myPlayer.controls,n);rt.enableClientSidePrediction&&this.state.myPlayer.bullets.push(s),this.state.myPlayer.controls.requestedBullet=s.data}const m=0!==this.state.myPlayer.controls.x||0!==this.state.myPlayer.controls.y||this.state.myPlayer.isPressingTrigger;(m||this.canSendIdleInput)&&(this.sendInputsToServer(this.state.myPlayer.controls),this.canSendIdleInput=!1,h&&(this.state.myPlayer.controls.x=u,this.state.myPlayer.controls.y=d)),m&&(this.canSendIdleInput=!0)}moveJoystick(t,e){this.state.myPlayer.controls.x=t,this.state.myPlayer.controls.y=e}adjustAim(t,e){this.state.myPlayer.controls.angle=this.state.players[this.state.myPlayer.name].data.angle=this.state.myPlayer.predictedPosition.angle=t,this.state.players[this.state.myPlayer.name].data.isImmune||(this.state.myPlayer.isPressingTrigger=e)}sendInputsToServer(t){this.state.pendingInputs.push({...t}),this.socket.emit("controlsInput",t),t.messageNumber++,t.requestedBullet=void 0}}const Mt=CONSTANTS.PLAYER_RADIUS*window.innerWidth;class Rt{canvas;ctx;state;lastTimeGettingShot=-1;constructor(t,e){this.canvas=t,this.ctx=t.getContext("2d"),this.state=e}render(t,e){const n=this.canvas.width,s=this.canvas.height;this.ctx.clearRect(0,0,n,s),this.drawWalls(n,s);const a=t-this.state.lastGameTickMessageTime;rt.showClientBullet&&(this.ctx.fillStyle="#770",this.state.bullets=this.state.bullets.filter((e=>{const a=t-e.receptionTime,o=e.data.x+e.data.speedX*a,i=e.data.y+e.data.speedY*a,r=o*n,l=i*s;return this.circle(r,l,2),0<=o&&o<=1&&0<=i&&i<=1}))),rt.showIdealClientBullet&&(this.ctx.fillStyle="#00f",this.state.bullets=this.state.bullets.filter((e=>{if(e.data.shooter===this.state.myPlayer.name)return!1;const a=t-e.receptionTime,o=e.data.x+e.data.speedX*a,i=e.data.y+e.data.speedY*a,r=o*n,l=i*s,c=.001*Math.min(t-e.receptionTime,500)/.5,u=e.display.x+a*e.data.speedX*n,d=e.display.y+a*e.data.speedY*s,h=u+(r-u)*c,m=d+(l-d)*c,p=-(this.state.players[e.data.shooter]?.data.latency||0);return!(distance(e.data.x+e.data.speedX*p,e.data.y+e.data.speedY*p,h/n,m/s)>=e.data.expirationDistance)&&(this.circle(h,m,2),0<=o&&o<=1&&0<=i&&i<=1)}))),rt.showClientPredictedBullet&&(this.state.myPlayer.bullets=this.state.myPlayer.bullets.filter((e=>{const a=t-e.timeCreated,o=e.data,i=o.x+o.speedX*a,r=o.y+o.speedY*a,l=i*n,c=r*s;return!(distance(o.x,o.y,i,r)>=o.expirationDistance)&&(this.ctx.fillStyle="#c0c",this.circle(l,c,2),0<=i&&i<=1&&0<=r&&r<=1)})));for(const n in this.state.players){if(n===this.state.myPlayer.name)continue;const s=this.state.players[n];if(rt.showExtrapolatedEnemyPositions){const n=this.getExtrapolatedPlayer(s,a,e);this.drawPlayer(n,t)}if(rt.showInterpolatedEnemyPositions){const e=CONSTANTS.INTERPOLATE_PLAYER_POSITION(s.data,t,s.interpolationBuffer);this.drawPlayer(e,t,"blue")}rt.showUninterpolatedEnemyPositions&&this.drawPlayer(s.data,t,"red")}if(rt.showServerPlayer&&this.drawPlayer(this.state.players[this.state.myPlayer.name].data,t,"purple"),rt.showPredictedPlayer&&this.drawPlayer(this.state.myPlayer.predictedPosition,t),rt.showWhatOtherClientsPredict){const n=this.getExtrapolatedPlayer(this.state.players[this.state.myPlayer.name],a,e);this.drawPlayer(n,t,"cyan")}}drawPlayer(t,e,n="#333"){const[s,a]=[t.x*this.canvas.width,t.y*this.canvas.height],o=e-t.lastTimeGettingShot,i=128*Math.sin(e/90)+128|0,r=o<=255;if(this.ctx.fillStyle=this.ctx.strokeStyle=t.isImmune?`rgb(255,255,${i})`:r?`rgb(255,${o},${o})`:n,this.circle(s,a,Mt,!r&&!t.isImmune),t.name===this.state.myPlayer.name&&r){t.lastTimeGettingShot!==this.lastTimeGettingShot&&(this.lastTimeGettingShot=t.lastTimeGettingShot,Z.injury());const n=50+200*Math.random();throttled(Lt,n,e)}const l=Math.cos(t.angle),c=Math.sin(t.angle),[u,d,h,m]=[s+Mt*l,a+Mt*c,s+Mt*l*1.8,a+Mt*c*1.8];this.ctx.lineWidth=6,this.line(u,d,h,m),this.ctx.lineWidth=2,this.ctx.fillStyle="#40f",this.ctx.fillText(t.name,s-2*t.name.length,a-21);this.ctx.strokeStyle="cyan",this.line(s-10,a-16,s+10,a-16),this.ctx.strokeStyle="purple",this.line(s-10,a-16,s-10+t.health/CONSTANTS.PLAYER_BASE_HEALTH*20,a-16)}drawWalls(t,e){this.ctx.lineWidth=2;const n=[["#0e8",WallType.NON_NEWTONIAN],["#44f",WallType.FENCE],["#410",WallType.BRICK]];for(const[s,a]of n){this.ctx.strokeStyle=s;for(const[n,s]of this.state.structures[a])this.line(n.x*t,n.y*e,s.x*t,s.y*e)}}circle(t,e,n,s){this.ctx.beginPath(),this.ctx.arc(t,e,n,0,7),this.ctx[s?"stroke":"fill"](),this.ctx.closePath()}line(t,e,n,s){this.ctx.beginPath(),this.ctx.moveTo(t,e),this.ctx.lineTo(n,s),this.ctx.stroke(),this.ctx.closePath()}getExtrapolatedPlayer(t,e,n){const s=e+t.data.latency,{x:a,y:o}=t.data,i=CONSTANTS.EXTRAPOLATE_PLAYER_POSITION(t.data,s),{x:r,y:l}=t.lastExtrapolatedPosition,c=distance(i.x,i.y,r,l)/n;if(c>1.5*CONSTANTS.PLAYER_SPEED){const t=1.5*CONSTANTS.PLAYER_SPEED/c,e=i.x-r,n=i.y-l;i.x=r+e*t,i.y=l+n*t}t.lastExtrapolatedPosition=i;const u=this.state.structures,d=u[WallType.BRICK].concat(u[WallType.FENCE]),[h,m]=CONSTANTS.GET_PLAYER_POSITION_AFTER_WALL_COLLISION(a,o,i.x,i.y,d);return{...i,x:h,y:m}}}function Lt(){const t=document.body.classList,e=document.getElementById("bloodscreen").classList;t.toggle("shake",!e.toggle("bleed")),e.toggle("bleed2",!t.toggle("shake2"))}let Dt=!1;let Bt=0;function Wt(t){let e,n,s,o,i,r,d,m,f;return r=new Tt({}),{c(){e=h("div"),n=h("button"),n.textContent="RANDOMIZE MAP",s=p(),o=h("div"),o.innerHTML='<h4>about me: <a href="https://ronald-ronaldmcorona.vercel.app" target="_blank">https://ronald-ronaldmcorona.vercel.app</a></h4> \n            <form action="https://www.paypal.com/donate" method="post" target="_top"><input type="hidden" name="hosted_button_id" value="NH4KDT52XGUTN"> \n                <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_LG.gif" name="submit" title="PayPal - The safer, easier way to pay online!" alt="Donate with PayPal button"> \n                <img alt="" src="https://www.paypal.com/en_US/i/scr/pixel.gif" width="1" height="1"></form>',i=p(),j(r.$$.fragment),g(o,"class","begging svelte-1o6zavn"),g(e,"class","svelte-1o6zavn")},m(u,h){c(u,e,h),l(e,n),l(e,s),l(e,o),l(e,i),q(r,e,null),d=!0,m||(f=y(n,"click",(function(){a(t[0].emit("command_randomize_map",{}))&&t[0].emit("command_randomize_map",{}).apply(this,arguments)})),m=!0)},p(e,n){t=e},i(t){d||(z(r.$$.fragment,t),d=!0)},o(t){G(r.$$.fragment,t),d=!1},d(t){t&&u(e),U(r),m=!1,f()}}}function Yt(t){let e,n;return e=new ut({props:{btnText:"⚙️",$$slots:{default:[Wt]},$$scope:{ctx:t}}}),{c(){j(e.$$.fragment)},m(t,s){q(e,t,s),n=!0},p(t,[n]){const s={};3&n&&(s.$$scope={dirty:n,ctx:t}),e.$set(s)},i(t){n||(z(e.$$.fragment,t),n=!0)},o(t){G(e.$$.fragment,t),n=!1},d(t){U(e,t)}}}function zt(t,e,n){let{socket:s}=e;return t.$set=t=>{"socket"in t&&n(0,s=t.socket)},[s]}Object.assign(window,{startBot:function(){clearInterval(Bt);const t=document.getElementById("mobile-game-joystick"),e=document.getElementById("mobile-game-trigger");if(!t||!e)throw"Something changed here that caused this to throw.";e.ontouchstart(),t.ontouchstart({targetTouches:[{clientX:0,clientY:0}]}),t.ontouchmove({targetTouches:[{clientX:0,clientY:100}]});let n=1;Bt=window.setInterval((()=>{t.ontouchmove({targetTouches:[{clientX:0,clientY:100*(n*=-1)}]})}),5e3)},endBot:function(){clearTimeout(Bt)}});class Gt extends F{constructor(t){super(),H(this,t,zt,Yt,o,{socket:0})}}function jt(t){let e,n,s,a,o,i,r,d,f,y,P,b,$,x,S;function w(e){t[5].call(null,e)}let E={};return void 0!==t[3]&&(E.updateScoreboard=t[3]),a=new Et({props:E}),v.push((()=>function(t,e,n){const s=t.$$.props[e];void 0!==s&&(t.$$.bound[s]=n,n(t.$$.ctx[s]))}(a,"updateScoreboard",w))),y=new it({props:{callback:t[4].moveJoystick.bind(t[4])}}),b=new Gt({props:{socket:t[0]}}),x=new st({props:{callback:t[4].adjustAim.bind(t[4])}}),{c(){e=h("center"),n=m(t[1]),s=p(),j(a.$$.fragment),i=p(),r=h("canvas"),d=p(),f=h("div"),j(y.$$.fragment),P=p(),j(b.$$.fragment),$=p(),j(x.$$.fragment),g(e,"class","svelte-157jzbb"),g(r,"class","svelte-157jzbb"),g(f,"class","input-container svelte-157jzbb")},m(o,u){c(o,e,u),l(e,n),c(o,s,u),q(a,o,u),c(o,i,u),c(o,r,u),t[6](r),c(o,d,u),c(o,f,u),q(y,f,null),l(f,P),q(b,f,null),l(f,$),q(x,f,null),S=!0},p(t,[e]){(!S||2&e)&&T(n,t[1]);const s={};var i;!o&&8&e&&(o=!0,s.updateScoreboard=t[3],i=()=>o=!1,N.push(i)),a.$set(s);const r={};1&e&&(r.socket=t[0]),b.$set(r)},i(t){S||(z(a.$$.fragment,t),z(y.$$.fragment,t),z(b.$$.fragment,t),z(x.$$.fragment,t),S=!0)},o(t){G(a.$$.fragment,t),G(y.$$.fragment,t),G(b.$$.fragment,t),G(x.$$.fragment,t),S=!1},d(n){n&&u(e),n&&u(s),U(a,n),n&&u(i),n&&u(r),t[6](null),n&&u(d),n&&u(f),U(y),U(b),U(x)}}}function qt(t,e,n){let s,a,{socket:o}=e,{username:i}=e;Ot.beginRetrieving(o);const r=new _t(i),l=new It(r,o);return S((()=>function(t,e,n){if(Dt)throw"The client is already running.";Dt=!0,CONSTANTS.DEV_MODE&&(window.state=e),t.canvas.height=t.canvas.width=window.innerWidth;const s=new Rt(t.canvas,e);n.on("mapdata",(t=>{console.log("got the mapdata"),e.structures=t})),n.on("removedPlayer",(t=>{delete e.players[t]})),n.on("gameTick",(t=>{e.processGameTick(t)})),function n(a){const o=Date.now(),i=o-(a||o);requestAnimationFrame((()=>n(o))),t.inputs.processInputs(i,o),s.render(o,i);const r=Object.values(e.players).sort(((t,e)=>e.data.score-t.data.score)).map((t=>({name:t.data.name,value:t.data.score}))).slice(0,5);t.updateScoreboard(r)}()}({inputs:l,canvas:s,updateScoreboard:a},r,o))),t.$set=t=>{"socket"in t&&n(0,o=t.socket),"username"in t&&n(1,i=t.username)},[o,i,s,a,l,function(t){a=t,n(3,a)},function(t){v[t?"unshift":"push"]((()=>{s=t,n(2,s)}))}]}class Ut extends F{constructor(t){super(),H(this,t,qt,jt,o,{socket:0,username:1})}}function Xt(t){let e,n;return e=new Ut({props:{socket:t[2],username:t[1]}}),{c(){j(e.$$.fragment)},m(t,s){q(e,t,s),n=!0},p(t,n){const s={};2&n&&(s.username=t[1]),e.$set(s)},i(t){n||(z(e.$$.fragment,t),n=!0)},o(t){G(e.$$.fragment,t),n=!1},d(t){U(e,t)}}}function Ht(t){let e,n;return e=new tt({props:{proceed:t[3],socket:t[2],blaze:t[0]}}),{c(){j(e.$$.fragment)},m(t,s){q(e,t,s),n=!0},p(t,n){const s={};1&n&&(s.blaze=t[0]),e.$set(s)},i(t){n||(z(e.$$.fragment,t),n=!0)},o(t){G(e.$$.fragment,t),n=!1},d(t){U(e,t)}}}function Ft(t){let e,n,s,a,o,i,r,l,d=!t[5]&&function(t){let e;return{c(){e=h("h1"),e.textContent="Sorry, only mobile devices are supported at the moment!",P(e,"color","white"),P(e,"background","black"),P(e,"text-align","center")},m(t,n){c(t,e,n)},d(t){t&&u(e)}}}();const m=[Ht,Xt],y=[];function T(t,e){return 0===t[1].length?0:1}a=T(t),o=y[a]=m[a](t);let b=t[4]&&function(t){let e;return{c(){e=h("div"),g(e,"id","debug-window"),g(e,"class","svelte-12em62w")},m(t,n){c(t,e,n)},d(t){t&&u(e)}}}();return{c(){d&&d.c(),e=p(),n=h("div"),s=p(),o.c(),i=p(),b&&b.c(),r=f(),g(n,"id","bloodscreen"),g(n,"class","svelte-12em62w")},m(t,o){d&&d.m(t,o),c(t,e,o),c(t,n,o),c(t,s,o),y[a].m(t,o),c(t,i,o),b&&b.m(t,o),c(t,r,o),l=!0},p(t,[e]){let n=a;a=T(t),a===n?y[a].p(t,e):(W(),G(y[n],1,1,(()=>{y[n]=null})),Y(),o=y[a],o||(o=y[a]=m[a](t),o.c()),z(o,1),o.m(i.parentNode,i))},i(t){l||(z(o),l=!0)},o(t){G(o),l=!1},d(t){d&&d.d(t),t&&u(e),t&&u(n),t&&u(s),y[a].d(t),t&&u(i),b&&b.d(t),t&&u(r)}}}function Kt(t,e,n){let{blaze:s}=e;const a=io({transports:["websocket"],upgrade:!1});let o="";const i=CONSTANTS.DEV_MODE,r=/Mobi|Android/i.test(navigator.userAgent);return t.$set=t=>{"blaze"in t&&n(0,s=t.blaze)},[s,o,a,function(t){n(1,o=t),console.log("Welcome to the game,",t+"!")},i,r]}return new class extends F{constructor(t){super(),H(this,t,Kt,Ft,o,{blaze:0})}}({target:document.body,props:{blaze:"Blaze"}})}();
//# sourceMappingURL=bundle.js.map
