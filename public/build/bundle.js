var app=function(){"use strict";function t(){}function e(t){return t()}function s(){return Object.create(null)}function n(t){t.forEach(e)}function a(t){return"function"==typeof t}function o(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function i(t,e){t.appendChild(e)}function l(t,e,s){t.insertBefore(e,s||null)}function r(t){t.parentNode.removeChild(t)}function c(t){return document.createElement(t)}function h(t){return document.createTextNode(t)}function u(){return h(" ")}function d(t,e,s,n){return t.addEventListener(e,s,n),()=>t.removeEventListener(e,s,n)}function p(t,e,s){null==s?t.removeAttribute(e):t.getAttribute(e)!==s&&t.setAttribute(e,s)}function y(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function m(t,e,s){t.classList[s?"add":"remove"](e)}let f;function g(t){f=t}function P(t){(function(){if(!f)throw new Error("Function called outside component initialization");return f})().$$.on_mount.push(t)}const T=[],S=[],x=[],E=[],b=Promise.resolve();let w=!1;function N(t){x.push(t)}let v=!1;const A=new Set;function O(){if(!v){v=!0;do{for(let t=0;t<T.length;t+=1){const e=T[t];g(e),$(e.$$)}for(T.length=0;S.length;)S.pop()();for(let t=0;t<x.length;t+=1){const e=x[t];A.has(e)||(A.add(e),e())}x.length=0}while(T.length);for(;E.length;)E.pop()();w=!1,v=!1,A.clear()}}function $(t){if(null!==t.fragment){t.update(),n(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(N)}}const C=new Set;let I;function k(t,e){t&&t.i&&(C.delete(t),t.i(e))}function _(t,e,s,n){if(t&&t.o){if(C.has(t))return;C.add(t),I.c.push((()=>{C.delete(t),n&&(s&&t.d(1),n())})),t.o(e)}}function M(t){t&&t.c()}function R(t,s,o){const{fragment:i,on_mount:l,on_destroy:r,after_update:c}=t.$$;i&&i.m(s,o),N((()=>{const s=l.map(e).filter(a);r?r.push(...s):n(s),t.$$.on_mount=[]})),c.forEach(N)}function L(t,e){const s=t.$$;null!==s.fragment&&(n(s.on_destroy),s.fragment&&s.fragment.d(e),s.on_destroy=s.fragment=null,s.ctx=[])}function D(t,e){-1===t.$$.dirty[0]&&(T.push(t),w||(w=!0,b.then(O)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Y(e,a,o,i,l,c,h=[-1]){const u=f;g(e);const d=a.props||{},p=e.$$={fragment:null,ctx:null,props:c,update:t,not_equal:l,bound:s(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(u?u.$$.context:[]),callbacks:s(),dirty:h};let y=!1;if(p.ctx=o?o(e,d,((t,s,...n)=>{const a=n.length?n[0]:s;return p.ctx&&l(p.ctx[t],p.ctx[t]=a)&&(p.bound[t]&&p.bound[t](a),y&&D(e,t)),s})):[],p.update(),y=!0,n(p.before_update),p.fragment=!!i&&i(p.ctx),a.target){if(a.hydrate){const t=function(t){return Array.from(t.childNodes)}(a.target);p.fragment&&p.fragment.l(t),t.forEach(r)}else p.fragment&&p.fragment.c();a.intro&&k(e.$$.fragment),R(e,a.target,a.anchor),O()}g(u)}class B{$destroy(){L(this,1),this.$destroy=t}$on(t,e){const s=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return s.push(e),()=>{const t=s.indexOf(e);-1!==t&&s.splice(t,1)}}$set(){}}function W(e){let s,a,o,m,f,g,P,T,S,x,E,b,w,N,v,A,O,$,C,I;return{c(){s=c("main"),a=c("div"),o=c("h1"),m=h("BLOOD "),f=h(e[0]),g=u(),P=c("h2"),P.textContent="A Devastating Bloodbath of Boundless Mortality",T=u(),S=c("div"),x=c("span"),E=c("form"),b=c("input"),w=u(),N=c("button"),N.textContent="GO",v=u(),A=c("span"),O=u(),$=c("bloodblaze"),p(o,"class","svelte-11xvoez"),p(P,"class","svelte-11xvoez"),p(a,"class","title svelte-11xvoez"),p(b,"autocomplete","off"),p(b,"placeholder","Enter your name"),p(b,"pattern","[A-Za-z0-9 _]*"),p(b,"class","svelte-11xvoez"),p(N,"class","svelte-11xvoez"),p(E,"type","text"),p(E,"action",""),p(x,"class","inner svelte-11xvoez"),p(S,"class","svelte-11xvoez"),p($,"class","svelte-11xvoez"),p(s,"class","svelte-11xvoez")},m(t,n){l(t,s,n),i(s,a),i(a,o),i(o,m),i(o,f),i(a,g),i(a,P),i(s,T),i(s,S),i(S,x),i(x,E),i(E,b),i(E,w),i(E,N),i(x,v),i(x,A),i(s,O),i(s,$),C||(I=[d(b,"keyup",z),d(E,"submit",e[1])],C=!0)},p(t,[e]){1&e&&y(f,t[0])},i:t,o:t,d(t){t&&r(s),C=!1,n(I)}}}function z(t){t.target.value=t.target.value.replace(/[^A-Za-z0-9 _]/g,"")}function G(t,e,s){let{proceed:n}=e,{blaze:a}=e,{socket:o}=e;return P((()=>{o.on("nomination",(([t,e])=>{t&&(o.removeAllListeners("nomination"),n(e)),alert(t?`Welcome, ${e}!`:`Sorry, "${e}" is not available.`)})),CONSTANTS.DEV_MODE&&o.emit("nomination",Math.random().toString())})),t.$set=t=>{"proceed"in t&&s(2,n=t.proceed),"blaze"in t&&s(0,a=t.blaze),"socket"in t&&s(3,o=t.socket)},[a,function(t){t.preventDefault();const e=t.target.children[0];e.value&&(o.emit("nomination",e.value),e.value="")},n,o]}class X extends B{constructor(t){super(),Y(this,t,G,W,o,{proceed:2,blaze:0,socket:3})}}function U(e){let s;return{c(){s=c("canvas"),p(s,"class","svelte-eupre8")},m(t,n){l(t,s,n),e[2](s)},p:t,i:t,o:t,d(t){t&&r(s),e[2](null)}}}function j(t,e,s){let n,a,o,i;const l=window.innerWidth/2.5/PHI;let{callback:r=(()=>0)}=e,c=0;function h(){i.clearRect(0,0,a,o),i.strokeStyle="#fba";const[t,e]=[40*Math.cos(c)+a/2,40*Math.sin(c)+o/2];i.beginPath(),i.arc(a/2,o/2,40,0,7),i.closePath(),i.stroke(),i.beginPath(),i.arc(t,e,6,0,7),i.fill()}return P((()=>{a=s(0,n.width=o=s(0,n.height=l,n),n),i=n.getContext("2d"),s(0,n.style.margin="5px",n),s(0,n.style.backgroundColor="transparent",n),h(),s(0,n.ontouchstart=()=>r(c,!0),n),s(0,n.ontouchmove=function(t){const e=+n.offsetLeft,s=+n.offsetTop,i=t.targetTouches[0].clientX-e-a/2,l=t.targetTouches[0].clientY-s-o/2,u=Math.atan2(l,i);c=u,h(),r(u,!0)},n),s(0,n.ontouchend=()=>r(c,!1),n)})),t.$set=t=>{"callback"in t&&s(1,r=t.callback)},[n,r,function(t){S[t?"unshift":"push"]((()=>{n=t,s(0,n)}))}]}class q extends B{constructor(t){super(),Y(this,t,j,U,o,{callback:1})}}function F(e){let s,n;return{c(){s=c("div"),n=c("canvas"),p(n,"class","svelte-18l9nl"),p(s,"class","svelte-18l9nl")},m(t,a){l(t,s,a),i(s,n),e[3](n),e[4](s)},p:t,i:t,o:t,d(t){t&&r(s),e[3](null),e[4](null)}}}function V(t,e,s){let n,a,o,i,l,r;const c=window.innerWidth/2.5/PHI;let{callback:h=(()=>0)}=e;function u(){l.clearRect(0,0,o,i),l.strokeStyle="black",l.lineWidth=8,l.fillStyle="rgb(71, 61, 61)",l.beginPath();const[t,e]=r;l.arc(t,e,40,0,7),l.closePath(),l.stroke(),l.fill();const n=t-o/2,c=e-i/2,h=1.2*Math.PI/4;s(1,a.style.transform=`\n        perspective(200px) \n        rotateY(${h*n|0}deg)\n        rotateX(${-h*c|0}deg)`,a)}return P((()=>{s(0,n.style.width=s(0,n.style.height=Math.round(c)+"px",n),n),o=s(1,a.width=i=s(1,a.height=Math.round(1.5*c),a),a);const t=.5*Math.floor(c-1.5*c);s(1,a.style.left=s(1,a.style.top=t+"px",a),a),l=a.getContext("2d"),r=[o/2,i/2],u(),s(0,n.ontouchstart=function(t){e=t.targetTouches[0].clientX,d=t.targetTouches[0].clientY},n),s(0,n.ontouchmove=function(t){const s=.75*(t.targetTouches[0].clientX-e),n=.75*(t.targetTouches[0].clientY-d),a=o/2-40-8,i=Math.pow(a,2),l=Math.pow(s,2)+Math.pow(n,2),c=Math.sqrt(i/l),[p,y]=l>i?[s*c,n*c]:[s,n];r[0]=p+o/2,r[1]=y+o/2,u();h(p/a,y/a)},n),s(0,n.ontouchend=function(){r[0]=o/2,r[1]=i/2,u(),h(0,0)},n);let e=0,d=0})),t.$set=t=>{"callback"in t&&s(2,h=t.callback)},[n,a,h,function(t){S[t?"unshift":"push"]((()=>{a=t,s(1,a)}))},function(t){S[t?"unshift":"push"]((()=>{n=t,s(0,n)}))}]}class K extends B{constructor(t){super(),Y(this,t,V,F,o,{callback:2})}}const Z={enableClientSidePrediction:!0,showPredictedPlayer:!0,showServerPlayer:!1,showServerBullet:!1,showClientBullet:!1,showIdealClientBullet:!0,showClientPredictedBullet:!0,showExtrapolatedEnemyPositions:!0,showInterpolatedEnemyPositions:!1,showUninterpolatedEnemyPositions:!1,showWhatOtherClientsPredict:!1,showGameMetadeta:!0};function H(t,e,s){const n=t.slice();return n[4]=e[s],n}function J(t){let e,s,n,a,o,y,m,f,g=t[4].split(tt).map(et).join(" ")+"";function P(){t[3].call(s,t[4])}return{c(){e=c("label"),s=c("input"),n=u(),a=c("h4"),o=h(g),y=u(),p(s,"type","checkbox"),p(a,"class","svelte-1p5603t"),p(e,"class","svelte-1p5603t")},m(r,c){l(r,e,c),i(e,s),s.checked=t[0][t[4]],i(e,n),i(e,a),i(a,o),i(e,y),m||(f=d(s,"change",P),m=!0)},p(e,n){t=e,5&n&&(s.checked=t[0][t[4]])},d(t){t&&r(e),m=!1,f()}}}function Q(e){let s,o,h,y,f,g,P,T=e[2],S=[];for(let t=0;t<T.length;t+=1)S[t]=J(H(e,T,t));return{c(){s=c("button"),s.textContent="⚙️",o=u(),h=c("div"),y=c("button"),y.textContent="back",f=u();for(let t=0;t<S.length;t+=1)S[t].c();p(s,"class","settings-button svelte-1p5603t"),p(h,"class","settings-page svelte-1p5603t"),m(h,"show",e[1].isOpen)},m(t,n){l(t,s,n),l(t,o,n),l(t,h,n),i(h,y),i(h,f);for(let t=0;t<S.length;t+=1)S[t].m(h,null);g||(P=[d(s,"click",(function(){a(e[1].toggle)&&e[1].toggle.apply(this,arguments)})),d(y,"click",(function(){a(e[1].toggle)&&e[1].toggle.apply(this,arguments)}))],g=!0)},p(t,[s]){if(e=t,5&s){let t;for(T=e[2],t=0;t<T.length;t+=1){const n=H(e,T,t);S[t]?S[t].p(n,s):(S[t]=J(n),S[t].c(),S[t].m(h,null))}for(;t<S.length;t+=1)S[t].d(1);S.length=T.length}2&s&&m(h,"show",e[1].isOpen)},i:t,o:t,d(t){t&&r(s),t&&r(o),t&&r(h),function(t,e){for(let s=0;s<t.length;s+=1)t[s]&&t[s].d(e)}(S,t),g=!1,n(P)}}}const tt=/([A-Z]+|[A-Z]?[a-z]+)(?=[A-Z]|\b)/,et=t=>t[0]?t[0].toUpperCase()+t.slice(1):t;function st(t,e,s){const n=Object.keys(Z).filter((t=>"boolean"==typeof Z[t])),a={toggle(){s(1,a.isOpen^=1,a)},isOpen:0};return[Z,a,n,function(t){Z[t]=this.checked,s(0,Z),s(2,n)}]}class nt extends B{constructor(t){super(),Y(this,t,st,Q,o,{})}}class at{data;receptionTime;display;constructor(t,e,s){this.data=t,this.receptionTime=e,this.display=s}}class ot{data;interpolationBuffer=[];lastExtrapolatedPosition;constructor(t){this.data=t,this.lastExtrapolatedPosition={x:t.x,y:t.y}}}class it{name;predictedPosition;controls;lastTimeShooting=-1;isPressingTrigger=!1;bullets=[];constructor(t){this.name=t.name,this.predictedPosition=t,this.controls={x:0,y:0,angle:0,messageNumber:0,deltaTime:0}}}class lt{pendingInputs=[];bullets=[];structures={[WallType.BRICK]:[],[WallType.FENCE]:[],[WallType.NON_NEWTONIAN]:[]};players;myPlayer;lastGameTickMessageTime;lastGameTickMessage;constructor(t){this.players={[t]:new ot(CONSTANTS.CREATE_PLAYER(t))},this.myPlayer=new it(CONSTANTS.CREATE_PLAYER(t)),this.lastGameTickMessageTime=Date.now(),this.lastGameTickMessage={players:[],newBullets:[]}}processGameTick(t){const e=Date.now();this.lastGameTickMessage=t,this.lastGameTickMessageTime=e,this.myPlayer.bullets=this.myPlayer.bullets.filter((e=>!t.deletedBullets[e.data.id])),this.bullets=this.bullets.filter((e=>!t.deletedBullets[e.data.id]));const s=window.innerWidth;for(const n of t.newBullets){const t=this.players[n.shooter];if(!t)break;const a=t.data;if(Z.showExtrapolatedEnemyPositions){const o={x:(t.lastExtrapolatedPosition.x+CONSTANTS.PLAYER_RADIUS*Math.cos(a.angle))*s,y:(t.lastExtrapolatedPosition.y+CONSTANTS.PLAYER_RADIUS*Math.sin(a.angle))*s};this.bullets.push(new at(n,e,o))}else{const t=(a.x+CONSTANTS.PLAYER_RADIUS*Math.cos(a.angle))*window.innerWidth,s=(a.y+CONSTANTS.PLAYER_RADIUS*Math.sin(a.angle))*window.innerWidth;this.bullets.push(new at(n,e,{x:t,y:s}))}}for(const s of t.players){this.players[s.name]||=new ot(s);const t=this.players[s.name];if(t.data=s,s.name===this.myPlayer.name){if(this.myPlayer.predictedPosition={...s,angle:this.myPlayer.controls.angle},CONSTANTS.DEV_MODE&&!Z.enableClientSidePrediction)continue;for(let t=0;t<this.pendingInputs.length;){const e=this.pendingInputs[t];e.messageNumber<=s.lastProcessedInput?this.pendingInputs.splice(t,1):(CONSTANTS.MOVE_PLAYER(this.myPlayer.predictedPosition,e),t++)}}else Z.showInterpolatedEnemyPositions&&t.interpolationBuffer.push([e,s])}}}const rt={value:0,beginRetrieving(t){if(this.isRetrieving)throw"Please only call this function once.";this.isRetrieving=!0;const e=()=>{const e=Date.now();t.volatile.emit("ping",(()=>{this.value=Date.now()-e,t.volatile.emit("networkLatency",this.value)}))};setInterval(e,5e3),e()},isRetrieving:!1};class ct{timeCreated;data;endPoint;constructor(t,e,s){this.timeCreated=Date.now();const[n,a]=function(t,e,s,n){const a=CONSTANTS.BULLET_SPEED*Math.cos(t.angle)+e.x*CONSTANTS.PLAYER_SPEED,o=CONSTANTS.BULLET_SPEED*Math.sin(t.angle)+e.y*CONSTANTS.PLAYER_SPEED,i=t.x+CONSTANTS.PLAYER_RADIUS*Math.cos(t.angle),l=t.y+CONSTANTS.PLAYER_RADIUS*Math.sin(t.angle),r=[t,{x:i+2e4*a,y:l+2e4*o}],[[c,h],u,d]=n.reduce((([t,e,s],n)=>{const a=CONSTANTS.LINE_SEGMENT_INTERSECTION_POINT(n,r);if(!a)return[t,e,s];const o=distance(a[0],a[1],i,l);return o<e?[a,o,n]:[t,e,s]}),[[69,420],1/0,null]);return[{x:i,y:l,speedX:a,speedY:o,id:s,shooter:t.name,expirationDistance:u},{x:c,y:h}]}(t,e,Math.random()+":"+t.name,s);this.data=n,this.endPoint=a}}class ht{state;socket;canSendIdleInput=!0;constructor(t,e){this.state=t,this.socket=e}processInputs(t,e){this.state.myPlayer.controls.deltaTime=t;const{x:s,y:n}=this.state.myPlayer.predictedPosition;CONSTANTS.MOVE_PLAYER(this.state.myPlayer.predictedPosition,this.state.myPlayer.controls);const{x:a,y:o}=this.state.myPlayer.predictedPosition,i=this.state.structures,l=i[WallType.BRICK].concat(i[WallType.FENCE]),[r,c]=CONSTANTS.GET_PLAYER_POSITION_AFTER_WALL_COLLISION(s,n,a,o,l),{x:h,y:u}=this.state.myPlayer.controls;let d=!1;if(a!==r||o!==c){this.state.myPlayer.predictedPosition.x=r,this.state.myPlayer.predictedPosition.y=c;const e=(r-s)/(t*CONSTANTS.PLAYER_SPEED),a=(c-n)/(t*CONSTANTS.PLAYER_SPEED),o=e**2+a**2,i=Math.min(Math.sqrt(1/o),1);this.state.myPlayer.controls.x=e*i,this.state.myPlayer.controls.y=a*i,d=!0}if(this.state.myPlayer.isPressingTrigger&&CONSTANTS.CAN_SHOOT(e,this.state.myPlayer.lastTimeShooting)){this.state.myPlayer.lastTimeShooting=e;const t=this.state.structures,s=t[WallType.BRICK].concat(t[WallType.NON_NEWTONIAN]),n=new ct(this.state.myPlayer.predictedPosition,this.state.myPlayer.controls,s);Z.enableClientSidePrediction&&this.state.myPlayer.bullets.push(n),this.state.myPlayer.controls.requestedBullet=n.data}const p=0!==this.state.myPlayer.controls.x||0!==this.state.myPlayer.controls.y||this.state.myPlayer.isPressingTrigger;(p||this.canSendIdleInput)&&(this.sendInputsToServer(this.state.myPlayer.controls),this.canSendIdleInput=!1,d&&(this.state.myPlayer.controls.x=h,this.state.myPlayer.controls.y=u)),p&&(this.canSendIdleInput=!0)}moveJoystick(t,e){this.state.myPlayer.controls.x=t,this.state.myPlayer.controls.y=e}adjustAim(t,e){this.state.myPlayer.controls.angle=this.state.players[this.state.myPlayer.name].data.angle=this.state.myPlayer.predictedPosition.angle=t,this.state.myPlayer.isPressingTrigger=e}sendInputsToServer(t){this.state.pendingInputs.push({...t}),this.socket.emit("controlsInput",t),t.messageNumber++,t.requestedBullet=void 0}}const ut=CONSTANTS.PLAYER_RADIUS*window.innerWidth;class dt{canvas;ctx;state;constructor(t,e){this.canvas=t,this.ctx=t.getContext("2d"),this.state=e}render(t,e){const s=this.canvas.width,n=this.canvas.height;this.ctx.clearRect(0,0,s,n),this.drawWalls(s,n);const a=t-this.state.lastGameTickMessageTime;for(const s in this.state.players){if(s===this.state.myPlayer.name)continue;const n=this.state.players[s];if(Z.showExtrapolatedEnemyPositions){const s=this.getExtrapolatedPlayer(n,a,e);this.drawPlayer(s,t)}if(Z.showInterpolatedEnemyPositions){const e=CONSTANTS.INTERPOLATE_PLAYER_POSITION(n.data,t,n.interpolationBuffer);this.drawPlayer(e,t,"blue")}Z.showUninterpolatedEnemyPositions&&this.drawPlayer(n.data,t,"red")}if(Z.showServerPlayer&&this.drawPlayer(this.state.players[this.state.myPlayer.name].data,t,"purple"),Z.showPredictedPlayer&&this.drawPlayer(this.state.myPlayer.predictedPosition,t),Z.showWhatOtherClientsPredict){const s=this.getExtrapolatedPlayer(this.state.players[this.state.myPlayer.name],a,e);this.drawPlayer(s,t,"cyan")}Z.showClientBullet&&(this.ctx.fillStyle="#770",this.state.bullets=this.state.bullets.filter((e=>{const a=t-e.receptionTime,o=e.data.x+e.data.speedX*a,i=e.data.y+e.data.speedY*a,l=o*s,r=i*n;return this.circle(l,r,2),0<=o&&o<=1&&0<=i&&i<=1}))),Z.showIdealClientBullet&&(this.ctx.fillStyle="#00f",this.state.bullets=this.state.bullets.filter((e=>{if(e.data.shooter===this.state.myPlayer.name)return!1;const a=t-e.receptionTime,o=e.data.x+e.data.speedX*a,i=e.data.y+e.data.speedY*a,l=o*s,r=i*n,c=.001*Math.min(t-e.receptionTime,500)/.5,h=e.display.x+a*e.data.speedX*s,u=e.display.y+a*e.data.speedY*n,d=h+(l-h)*c,p=u+(r-u)*c,y=-(this.state.players[e.data.shooter]?.data.latency||0);return!(distance(e.data.x+e.data.speedX*y,e.data.y+e.data.speedY*y,d/s,p/n)>=e.data.expirationDistance)&&(this.circle(d,p,2),0<=o&&o<=1&&0<=i&&i<=1)}))),Z.showClientPredictedBullet&&(this.state.myPlayer.bullets=this.state.myPlayer.bullets.filter((e=>{const a=t-e.timeCreated,o=e.data,i=o.x+o.speedX*a,l=o.y+o.speedY*a,r=i*s,c=l*n;return!(distance(o.x,o.y,i,l)>=o.expirationDistance)&&(this.ctx.fillStyle="#c0c",this.circle(r,c,2),0<=i&&i<=1&&0<=l&&l<=1)})))}drawPlayer(t,e,s="#333"){const[n,a]=[t.x*this.canvas.width,t.y*this.canvas.height],o=e-t.lastTimeGettingShot,i=o<=255;if(this.ctx.fillStyle=this.ctx.strokeStyle=i?`rgb(255,${o},${o})`:s,t.name===this.state.myPlayer.name&&i){const t=50+200*Math.random();throttled(pt,t,e)}this.circle(n,a,ut,!i);const[l,r]=[n+ut*Math.cos(t.angle),a+ut*Math.sin(t.angle)];this.circle(l,r,2),this.ctx.fillStyle="#40f",this.ctx.fillText(t.name,n-17,a-17)}drawWalls(t,e){const s=[["#0e8",WallType.NON_NEWTONIAN],["#44f",WallType.FENCE],["#410",WallType.BRICK]];for(const[n,a]of s){this.ctx.strokeStyle=n;for(const[s,n]of this.state.structures[a])this.line(s.x*t,s.y*e,n.x*t,n.y*e)}}circle(t,e,s,n){this.ctx.beginPath(),this.ctx.arc(t,e,s,0,7),this.ctx[n?"stroke":"fill"](),this.ctx.closePath()}line(t,e,s,n){this.ctx.beginPath(),this.ctx.moveTo(t,e),this.ctx.lineTo(s,n),this.ctx.stroke(),this.ctx.closePath()}getExtrapolatedPlayer(t,e,s){const n=e+t.data.latency,{x:a,y:o}=t.data,i=CONSTANTS.EXTRAPOLATE_PLAYER_POSITION(t.data,n),{x:l,y:r}=t.lastExtrapolatedPosition,c=distance(i.x,i.y,l,r)/s;if(c>1.5*CONSTANTS.PLAYER_SPEED){const t=1.5*CONSTANTS.PLAYER_SPEED/c,e=i.x-l,s=i.y-r;i.x=l+e*t,i.y=r+s*t}t.lastExtrapolatedPosition=i;const h=this.state.structures,u=h[WallType.BRICK].concat(h[WallType.FENCE]),[d,p]=CONSTANTS.GET_PLAYER_POSITION_AFTER_WALL_COLLISION(a,o,i.x,i.y,u);return{...i,x:d,y:p}}}function pt(){const t=document.body.classList,e=document.getElementById("bloodscreen").classList;t.toggle("shake",!e.toggle("bleed")),e.toggle("bleed2",!t.toggle("shake2"))}let yt=!1;let mt=0;function ft(t){let e,s,n,a,o,d,m,f,g,P,T,S,x;g=new K({props:{callback:t[3].moveJoystick.bind(t[3])}});let E=t[4]&&function(t){let e,s;return e=new nt({}),{c(){M(e.$$.fragment)},m(t,n){R(e,t,n),s=!0},i(t){s||(k(e.$$.fragment,t),s=!0)},o(t){_(e.$$.fragment,t),s=!1},d(t){L(e,t)}}}();return S=new q({props:{callback:t[3].adjustAim.bind(t[3])}}),{c(){e=c("center"),s=h(t[0]),n=u(),a=c("div"),o=u(),d=c("canvas"),m=u(),f=c("div"),M(g.$$.fragment),P=u(),E&&E.c(),T=u(),M(S.$$.fragment),p(e,"class","svelte-1gms7s9"),p(a,"class","scoreboard svelte-1gms7s9"),p(d,"class","svelte-1gms7s9"),p(f,"class","input-container svelte-1gms7s9")},m(r,c){l(r,e,c),i(e,s),l(r,n,c),l(r,a,c),t[6](a),l(r,o,c),l(r,d,c),t[7](d),l(r,m,c),l(r,f,c),R(g,f,null),i(f,P),E&&E.m(f,null),i(f,T),R(S,f,null),x=!0},p(t,[e]){(!x||1&e)&&y(s,t[0])},i(t){x||(k(g.$$.fragment,t),k(E),k(S.$$.fragment,t),x=!0)},o(t){_(g.$$.fragment,t),_(E),_(S.$$.fragment,t),x=!1},d(s){s&&r(e),s&&r(n),s&&r(a),t[6](null),s&&r(o),s&&r(d),t[7](null),s&&r(m),s&&r(f),L(g),E&&E.d(),L(S)}}}function gt(t,e,s){let n,a,{socket:o}=e,{username:i}=e;rt.beginRetrieving(o);const l=new lt(i),r=new ht(l,o);P((()=>function(t,e,s){if(yt)throw"The client is already running.";yt=!0,CONSTANTS.DEV_MODE&&(window.state=e),t.canvas.height=t.canvas.width=window.innerWidth;const n=new dt(t.canvas,e);s.on("mapdata",(t=>{console.log("got the mapdata"),e.structures=t})),s.on("removedPlayer",(t=>{delete e.players[t]})),s.on("gameTick",(t=>{e.processGameTick(t)})),function s(a){const o=Date.now(),i=o-(a||o);requestAnimationFrame((()=>s(o))),t.inputs.processInputs(i,o),n.render(o,i);const l=CONSTANTS.DEV_MODE&&Z.showGameMetadeta?`<br> pending requests: ${e.pendingInputs.length}<br> network latency: ${rt.value}`:"";t.scoreboard.innerHTML=Object.values(e.players).sort(((t,e)=>e.data.score-t.data.score)).map((t=>`<span style="color: orange">${t.data.name}:</span> ${t.data.score}`)).join("<br>")+l}()}({inputs:r,canvas:n,scoreboard:a},l,o)));const c=CONSTANTS.DEV_MODE;return t.$set=t=>{"socket"in t&&s(5,o=t.socket),"username"in t&&s(0,i=t.username)},[i,n,a,r,c,o,function(t){S[t?"unshift":"push"]((()=>{a=t,s(2,a)}))},function(t){S[t?"unshift":"push"]((()=>{n=t,s(1,n)}))}]}Object.assign(window,{startBot:function(){clearInterval(mt);const[t,e,s,n]=[...document.querySelector(".input-container").children];if(!t||!n)throw"Something changed here that caused this to throw.";n.ontouchstart(),t.ontouchstart({targetTouches:[{clientX:0,clientY:0}]}),t.ontouchmove({targetTouches:[{clientX:0,clientY:100}]});let a=1;mt=window.setInterval((()=>{t.ontouchmove({targetTouches:[{clientX:0,clientY:100*(a*=-1)}]})}),5e3)},endBot:function(){clearTimeout(mt)}});class Pt extends B{constructor(t){super(),Y(this,t,gt,ft,o,{socket:5,username:0})}}function Tt(t){let e,s;return e=new Pt({props:{socket:t[2],username:t[1]}}),{c(){M(e.$$.fragment)},m(t,n){R(e,t,n),s=!0},p(t,s){const n={};2&s&&(n.username=t[1]),e.$set(n)},i(t){s||(k(e.$$.fragment,t),s=!0)},o(t){_(e.$$.fragment,t),s=!1},d(t){L(e,t)}}}function St(t){let e,s;return e=new X({props:{proceed:t[3],socket:t[2],blaze:t[0]}}),{c(){M(e.$$.fragment)},m(t,n){R(e,t,n),s=!0},p(t,s){const n={};1&s&&(n.blaze=t[0]),e.$set(n)},i(t){s||(k(e.$$.fragment,t),s=!0)},o(t){_(e.$$.fragment,t),s=!1},d(t){L(e,t)}}}function xt(t){let e,s,a,o,i,d,y;const m=[St,Tt],f=[];function g(t,e){return 0===t[1].length?0:1}a=g(t),o=f[a]=m[a](t);let P=t[4]&&function(t){let e;return{c(){e=c("div"),p(e,"id","debug-window"),p(e,"class","svelte-yuxzpj")},m(t,s){l(t,e,s)},d(t){t&&r(e)}}}();return{c(){e=c("div"),s=u(),o.c(),i=u(),P&&P.c(),d=h(""),p(e,"id","bloodscreen"),p(e,"class","svelte-yuxzpj")},m(t,n){l(t,e,n),l(t,s,n),f[a].m(t,n),l(t,i,n),P&&P.m(t,n),l(t,d,n),y=!0},p(t,[e]){let s=a;a=g(t),a===s?f[a].p(t,e):(I={r:0,c:[],p:I},_(f[s],1,1,(()=>{f[s]=null})),I.r||n(I.c),I=I.p,o=f[a],o||(o=f[a]=m[a](t),o.c()),k(o,1),o.m(i.parentNode,i))},i(t){y||(k(o),y=!0)},o(t){_(o),y=!1},d(t){t&&r(e),t&&r(s),f[a].d(t),t&&r(i),P&&P.d(t),t&&r(d)}}}function Et(t,e,s){let{blaze:n}=e;const a=io({transports:["websocket"],upgrade:!1});let o="";const i=CONSTANTS.DEV_MODE;return t.$set=t=>{"blaze"in t&&s(0,n=t.blaze)},[n,o,a,function(t){s(1,o=t),console.log("Welcome to the game,",t+"!")},i]}return new class extends B{constructor(t){super(),Y(this,t,Et,xt,o,{blaze:0})}}({target:document.body,props:{blaze:"Blaze"}})}();
//# sourceMappingURL=bundle.js.map
